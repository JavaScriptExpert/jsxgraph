<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns="">Interactive SVG with JSXGraph</title><meta xmlns="" name="keywords" content="conference proceedings, paper formats"/><meta xmlns="" name="author" content="Bianca Valentin"/><meta xmlns="" name="author" content="Michael Gerhaeuser"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Content-Style-Type" content="text/css"/><style type="text/css">
ul.simple {list-style-type: none}
ul.bulleted {list-style-type: disc}
ul.openBulleted {list-style-type: circle}
ul.dashed {list-style-type: square}
ol.arabic {list-style-type: decimal}
ol.ualpha {list-style-type: upper-alpha}
ol.uroman {list-style-type: upper-roman}
ol.lalpha {list-style-type: lower-alpha}
ol.lroman {list-style-type: lower-roman}
ol.ftnote {list-style-type: decimal}
    </style><link rel="stylesheet" type="text/css" href="http://www.svgopen.org/2008/docbook/ideadb.css"/></head><body><h1 xmlns="" class="title">Interactive SVG with JSXGraph</h1><h2 xmlns="" class="subt">JSXGraph</h2><p xmlns="" class="keyword"><i class="keywordHeader">Keywords: </i><a id="K1.conference.proceedings" title="conference proceedings"/>conference proceedings, <a id="K2.paper.formats" title="paper formats"/>paper formats</p><p xmlns="" class="author"><span class="authorName">Bianca Valentin</span><br/>PhD student<br/><br/>University of Bayreuth<br/>Department of mathematics<br/>
                            <br/>Bayreuth
                            <br/>Universitaetsstr. 30
                            <br/>95444
                            <br/>Germany
                            <br/>++49-921 55 3389
                        </p><p xmlns="" class="bioHeader"><i>Biography</i></p><blockquote xmlns="" class="bio"><p>Bla bla</p></blockquote><p xmlns="" class="author"><span class="authorName">Michael Gerhaeuser</span><br/>Student<br/><br/>University of Bayreuth<br/>Department of mathematics<br/>
                            <br/>Bayreuth
                            <br/>Universitaetsstr. 30
                            <br/>95444
                            <br/>Germany
                            <br/>
                        </p><p xmlns="" class="bioHeader"><i>Biography</i></p><blockquote xmlns="" class="bio"><p>Bla bla</p></blockquote><hr xmlns="" class="upperBorder"/><h2 xmlns="" class="abstractHeader">Abstract</h2><hr xmlns="" class="lowerBorder"/><div xmlns="" class="abstract"><p>JSXGraph is a client-side web library for displaying interactive mathematics and drawings in a web browser. This article shall demonstrate the possibilities of JSXGraph and explain how they are implemented.</p></div><hr class="upperBorder"/><h2 class="tocHeader">Table of Contents</h2><hr class="lowerBorder"/><p class="toc"><b xmlns=""><a href="#S1.">1. Introduction</a></b><br xmlns=""/><b xmlns=""><a href="#S2.">2. Mathematics</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.1">2.1 JSXGraph as a web viewer for dynamic geometry software</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.2">2.2 Currently supported file formats</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.3">2.3 Constructing from scratch</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.4">2.4 Calculus</a><br xmlns=""/><b xmlns=""><a href="#S3.">3. Turtle graphics</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S3.1">3.1 Turtle graphics in mathematical modelling</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S3.2">3.2 Drawing with turtle graphics</a><br xmlns=""/><b xmlns=""><a href="#S4.">4. Charts</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S4.1">4.1 Title of subsubsection</a><br xmlns=""/><b xmlns=""><a href="#S5.">5. JSXGraph as front end to server side applications</a></b><br xmlns=""/><b xmlns=""><a href="#S6.">6. Plugins for integration in other web applications</a></b><br xmlns=""/><b xmlns=""><a href="#S7.">7. Using JSXGraph with a connection to a server</a></b><br xmlns=""/><b xmlns=""><a href="#S8.">8. Implementation details</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.1">8.1 SVG vs. VML</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.2">8.2 HTML elements</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3">8.3 Speed improvements</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.1">8.3.1 Avoid DOM accesses with getElementById()</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.2">8.3.2 Suspend the update of SVG nodes</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.3">8.3.3 Use memoizers</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.4">8.3.4 Distinguish mouse move and mouse up events</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.5">8.3.5 Reduce the download and initialization time</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.6">8.3.6 Use the function invocation pattern</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S8.3.7">8.3.7 An Internet Explorer trick</a><br xmlns=""/><b xmlns=""><a href="#S.Bibliography">Bibliography</a></b><br xmlns=""/><b xmlns=""><a href="#S.Footnotes">Footnotes</a></b><br xmlns=""/></p>
        <h2 xmlns=""><a id="S1.">1. Introduction</a></h2>
        <p xmlns="">JSXGraph<a href="#FT1" class="fnref"><b>[1]</b></a>  
            is a client-side web application/library for advanced vector graphics in a web browser. Its range of applications starts from
            the display of simple bar charts and pie charts up to the interactive display of function graphs and 
            Geometry constructions used in schools and universities.
            Even more advanced features of JSXGraph are the on-the-fly solving of Differential Equation Systems, the display of 
            Lindenmayer systems<a href="#FT2" class="fnref"><b>[2]</b></a>, which are of importance in Biology, and dynamic computation of regression polynomials.
        </p>
        <p xmlns="">
            JSXGraph is a library which may be used in various situations. The main application is to serve as a client-side viewer for
            educational Mathematics materials for schools and universities. 
            Usually, these constructions, especially from Euclidean Geometry, are available in different propietary XML file formats, and are 
            intended to be displayed by their associated Java applet. 
            In order to compensate the slow demise of Java applets in the web browsers, JSXGraph may prove to be
            valuable. 
            At the moment JSXGraph supports the file format of 
            GEONExT<a href="#FT3" class="fnref"><b>[3]</b></a>, 
            Intergeo<a href="#FT4" class="fnref"><b>[4]</b></a>, 
            and - at least partially - 
            GeoGebra<a href="#FT5" class="fnref"><b>[5]</b></a>.
            Since JSXGraph comes with its own implementation of unzip and gunzip, 
            it should be easy to adapt JSXGraph to a whole varity of even more file formats.
        </p>
        <p xmlns="">
            Beside the using it as viewer of existing material, the JSXGraph library may be used as an API for advanced special purpose visualizations.
            JSXGraph enables interactive experiments with sophisticated mathematical problems in the web browser. One example is the simulation
            of the epidemiology model for the swine flu<a href="#FT6" class="fnref"><b>[6]</b></a>.
            The possibilities of JSXGraph in this respect exceed by far the options offered by software which is common in schools today.
        </p>
        <p xmlns="">
            Another possible application of JSXGraph is to use it as front end for server based applications. 
            One example is the widely-spread free statistics software R<a href="#FT7" class="fnref"><b>[7]</b></a>. 
            After the mouse up event is fired in this application, the coordinates of the points
            are sent via AJAX to the R interface on server side. After doing some R computations on the server side, the 
            web server sends the results back to the browser. There, the display is updated by JSXGraph. 
            A more simple application of JSXGraph can be the creation of charts on server side.
            For example, PHP could be used to generate JSXGraph charts which are sent to the web
            browser. In this way, the high quality of the vector graphics display can be fully exploited.
            The additional overhead of downloading JSXGraph is less than 100 kByte, which is smaller than most bitmap images.
        </p>
        <p xmlns="">
            From a technical point of view, JSXGraph is implemented in JavaScript. It generates SVG output on Mozilla- and Webkit-based 
            browsers, and VML on the Internet Explorer. 
            Therefore, JSXGraph runs on every modern browser. 
        </p>
        <p xmlns="">
            JSXGraph is open source software, released under the LGPL â€“ Lesser GNU General Public License. The source code
            is hosted by sourceforge.
        </p>
    
        <h2 xmlns=""><a id="S2.">2. Mathematics</a></h2>
        <p xmlns="">The originally intended purpose of JSXGraph was having a JavaScript library for displaying geometric constructions in a web browser. So it is possible to visualize geometric elements that are taught in schools and universities like points, lines, circles, arcs, and angles, as well as predefined composition elements. JSXGraph not only provides tools for displaying geometric constructions but also for doing calculus like plotting curves starting from function graphs with tangents up to parametric and polar curves, splines or other interpolation methods. </p>
        
            <h3 xmlns=""><a id="S"> JSXGraph as a web viewer for dynamic geometry software</a></h3>
            <p xmlns="">Dynamic geometry software (DGS) are computer programs which allow one to create and then manipulate geometric constructions, primarily in plane geometry. In most DGS, one starts construction by putting a few points and using them to define new objects such as lines, circles or other points. After some construction is done, one can move the points one started with and see how the construction changes.</p>
            <p xmlns="">
            There are lots of different available software packages to play around dynamically with geometry at schools and universities. Most of them are written in Java, such as GeoGebra, Cinderella, Compass and Ruler or GEONExT, others like The Geometer's Sketchpad or Cabri offer a Java based web viewer. So if you want to integrate a construction that was created with one of these DGS in a web page, it takes some time to load the corresponding Java applet before you can use it. There are moreover big doubts about the future of Java in a web browser because Java applets are vanishing more and more from the internet and are actually not supported in browsers on modern mobile internet devices. As a result, the idea of JSXGraph was to read GEONExT Files and display them in the browser using JavaScript to manage the corresponding DOM elements of SVG or VML, depending on what browser is used. JavaScript is furthermore used to realize the dynamic in DGS by capturing the browser's mouse events. </p>
        
        
            <h3 xmlns=""><a id="S"> Currently supported file formats</a></h3>
            <p xmlns="">Since JSXGraph has evolved from the GEONExT project, the support of its file format is almost complete. 
Other file formats are under development. For example, JSXGraph is involved in the European Intergeo project which shall unite several dynamic geometry softwares (GeoGebra, Cabri, GEONExT, Cinderella, etc.) agreeing about a common file format that can be displayed within a browser using the Intergeo reader of JSXGraph. Support for reading GeoGebra files directly is under development in cooperation with the GeoGebra developers.
            </p>
        
        
            <h3 xmlns=""><a id="S"> Constructing from scratch</a></h3>
            <p xmlns="">The JSXGraph API used in the readers for the different file formats can also be used to create a construction from scratch or to manipulate a construction loaded from a given file. JSXGraph contains functions for compass and ruler constructions in euclidean geometry basing on points, lines, circles, arcs, and angles. Those can be intersected or combined in predefined ways. For example one can construct a line that is parallel to another one or a point that is the midpoint between two other points by using integrated JSXGraph methods. Additionally, one can easily implement own composition elements with JavaScript and the above-mentioned functions. 
            </p>
        
        
            <h3 xmlns=""><a id="S"> Calculus</a></h3>
            <p xmlns="">Beyond the capabilities of JSXGraph with regard to geometric constructions, one is also able to visualize calculus.</p>
            <p xmlns="">The possibilities start from plotting simple functiongraphs to displaying more complex graphs like parametric and polar curves which can be analyzed using the implemented methods for tangents, integrals or spline interpolation. 
            </p>
            <p xmlns="">Example:  examine the influence of function parameters like in code example 1[TODO]</p>
            <p xmlns="">With an implementation of an explicit Runge-Kutta process, JSXGraph can also solve ordinary differential equations on the fly with the opportunity to change the parameters on runtime and watching the results.
            </p>
                    
    
        <h2 xmlns=""><a id="S3.">3. Turtle graphics</a></h2>
        <p xmlns="">Turtle graphics as a method of drawing offer a huge variety of applications. So JSXGraph provides a comfortable support of functions round about them.</p>
        
            <h3 xmlns=""><a id="S"> Turtle graphics in mathematical modelling</a></h3>
            <p xmlns="">Mathematic modelling with differential equations can also be done by using turtle graphics. Exponential population growth model can be easily simulated by using the discrete analogue of the corresponding differential equation and computing the movement of the turtle in equidistant small time intervals. </p>
                <table xmlns="" class="codeBlock"><tr><td><pre> 
                var board = JXG.JSXGraph.initBoard('box', {originX: 10, originY: 250, unitX: 40, unitY: 20, axis:true});
                var t = board.createElement('turtle',[4,3,70]);
                ...
                var dy = alpha*t.Y()*dx;   // Exponential growth
                t.moveTo([dx+t.X(),dy+t.Y()]);
                </pre></td></tr></table>
            <p xmlns="">In a similar way, logistic or autocatalytic population growth processes can be modelled. A further application which can be simulated with turtle graphics is epidemiology where a set of differential equations is given to predict the immediate consequences of a epidemic like the Hong Kong flu or the swine flu. With few lines of programm code in JSXGraph one can study the chronological sequence of the rate of susceptible, infected and recovered population.
            </p>
        
        
            <h3 xmlns=""><a id="S"> Drawing with turtle graphics</a></h3>
            <p xmlns="">An advantage of using turtle graphics is the easy way to draw. The standard commands are going forward for a given numer of units and turning left or right in a given angle. The following programm listing draws the Nikolaus graph shown in the picture below.</p>
                <table xmlns="" class="codeBlock"><tr><td><pre> 
                for(i=1;i&lt;=4;i++) {
                    t.forward(100);
                    t.right(90);
                }
                t.right(45);
                t.forward(100*Math.sqrt(2));
                for(i=1;i&lt;=2;i++) {
                   t.left(90);
                   t.forward(50*Math.sqrt(2));
                }
                t.left(90);
                t.forward(100*Math.sqrt(2));
            </pre></td></tr></table>
            <table xmlns="" class="codeBlock"><tr><td><pre>
                &lt;figure xml:id="nikolaus"&gt;
                    &lt;title&gt;The Nikolaus Graph&lt;/title&gt;
                    &lt;mediaobject&gt;
                        &lt;imageobject&gt;
                            &lt;imagedata fileref="nikolaus.svg" format="svg" width="60%"/&gt;
                        &lt;/imageobject&gt;
                         &lt;textobject&gt;&lt;phrase&gt;The Nikolaus Graph&lt;/phrase&gt;&lt;/textobject&gt;
                    &lt;/mediaobject&gt;
                &lt;/figure&gt;
            </pre></td></tr></table>       
            <p xmlns="">This approach can be used to produce easily beautiful Lindenmayer systems known from chaos theory like plants or penrose tilings. Similarly, well-known fractals like the Sierpinski triangle or the Koch curve can be drawn. Other applications can be found in statistics where one can simulate random walks with turtles. Additionally, abecedarian games like snake can be implemented in a few lines.
            </p>
        
    
        <h2 xmlns=""><a id="S4.">4. Charts</a></h2>
        <p xmlns="">Having all the geometric objects with all their possibilities within JSXGraph, it was not difficult to integrate support for charts which provide all the optical properties that are integrated in JSXGraph. So it is possible to create easily dynamic bar charts or interactive pie charts.</p>
        
        
            <h3 xmlns=""><a id="S"> Title of subsubsection</a></h3>
            <p xmlns="">A paragraph ...</p>
        
    
        <h2 xmlns=""><a id="S5.">5. JSXGraph as front end to server side applications</a></h2>
        <p xmlns="">JavaScript enables us to use the XMLHTTPRequest object to interact with server side applications. Currently one can use our XMLHTTPRequest object wrapper JXG.FileReader or the AJAX wrappers
        provided by Prototype<a href="#FT8" class="fnref"><b>[8]</b></a> and jQuery <a href="#FT9" class="fnref"><b>[9]</b></a>.
        So JSXGraph can be used to visualize the output of server side calculations but provides new input for server applications, too.
        </p>
        <div xmlns="" class="figure"><table class="codeBlock"><tr><td><pre>       
&lt;div id="jxgbox" class="jxgbox" style="width:700px; height:400px;" onmouseup="doUpdate();"&gt;&lt;/div&gt; 
&lt;script&gt;
var brd = JXG.JSXGraph.initBoard('jxgbox', {originX: 20, originY: 300, unitX: 60, unitY: 5, axis:true}),
    g = brd.createElement('curve', [[0,11],[0,0]], {strokecolor:'red'}),
    i,
    p = [];

for (i=0;i&lt;12;i++) {
    p[i] = brd.createElement('point', [i,Math.random()*50],{name:' ',style:7}); 
} 

var doUpdate = function() {
    brd.update();
    // Generate a ";"-separated list
    var t = '';
    for (var i=0;i&lt;p.length;i++) {
        t += p[i].Y() + ';';
    }
    new Ajax.Request('/directory/rserv.php', {
        method:'post',
        parameters:'input='+escape(t),
        onComplete: function(transport) {
            var t, result, a, m;
            if (200 == transport.status) {
                var t = transport.responseText;
                var result = t.match(/"(.*)"/gi);
                result = RegExp.$1;
                a = res.split(";");
                m = a[0]*1.0;
                g.dataY = [m,m];
                brd.update();
            };
        }
    });
};  

doUpdate();
&lt;/script&gt;

//---------------------------------------------
// The PHP file rserv.php for the response:
&lt;?php
$input = $_POST["input"];
if (!get_magic_quotes_gpc()) {
    $input = addslashes($input);
}
$cmd = "/usr/bin/Rscript LokSkala.R '" . $input ."'";
passthru($cmd);
?&gt;
       </pre></td></tr></table><blockquote class="figureTitle"><p><b>Example 1: maybe a little example, but what? the r example is quite too big...</b></p></blockquote></div>
    
        <h2 xmlns=""><a id="S6.">6. Plugins for integration in other web applications</a></h2>
        <p xmlns="">To ease the integration of JSXGraph into other web applications we provide some plugins for a couple of existing web applications. That are the blogging software Wordpress, 
        the basis software for Wikipedia called MediaWiki, and the course management system Moodle. The latter one ist still experimental. The user only has to provide a few options for the drawing panel
        and the JavaScript construction code or a url to a file in a format supported by JSXGraph. The rest is done by the plugin, like loading the necessary files, initializing the division element containing the
        drawing panel and finally loading the file or the javascript construction code.</p>
        <div xmlns="" class="figure"><table class="codeBlock"><tr><td><pre>
[... wiki page content ...]
&lt;jsxgraph height="500" width="600" board="board"  box="box1"&gt;
brd = JXG.JSXGraph.initBoard('box1', {originX: 10, originY: 250, unitX: 40, unitY: 20, axis:true});
var t = brd.createElement('point',[4,3]);
&lt;/jsxgraph&gt;
[... wiki page content ...]
         </pre></td></tr></table><blockquote class="figureTitle"><p><b>Example 2: Include a JSXGraph construction on a MedaWiki page using the MediaWiki plugin</b></p></blockquote></div>
   
        <h2 xmlns=""><a id="S7.">7. Using JSXGraph with a connection to a server</a></h2>
        <p xmlns=""> A paragraph ...</p>          
    
        <h2 xmlns=""><a id="S8.">8. Implementation details</a></h2>
        <p xmlns="">
            The main focus of JSXGraph is on interactivity. The user should experience immediate response to the dragging of points
            with the mouse. So, special care had to be spent on fast reacting to the mouse move events and mouse up events. Contrarily
            we want to exploit the superb output quality of vector graphics. These two controversial goals - 
            speed versus quality - have to be balanced. 
        </p> 
        <p xmlns="">
            For the browser abstraction JSXGraph uses either the Prototype JavaScript library<a href="#FT10" class="fnref"><b>[10]</b></a> 
            or 
            jQuery<a href="#FT11" class="fnref"><b>[11]</b></a>.  
            JSXGraph can be used with either of these two libraries equally good. 
            The access to these libraries is restricted to a minimum and it is capsuled in a few lines in the
            source code file jsxgraph.js. These libraries are nerly exclusively used for the corss-browser handling of events.
            Everything else in JSXGraph is built up from scratch and does not rely on third-party libraries.
            So, it should be easy to port JSXGraph to a further framework, if necessary.
        </p>
        
            <h3 xmlns=""><a id="S"> SVG vs. VML</a></h3>
            <p xmlns="">
                One of the major user audiences of JSXGraph are schools. In general, schools are adapting only slowly to new technologies.
                That is one of the reason, why Internet Explorer is widely used in schools. Since we can not afford to exclude schools as
                users of JSXGraph we had to adapt it to the Internet Explorer, too. Since the year 1998 
                Microsoft<a href="#FT12" class="fnref"><b>[12]</b></a><a href="#VML98" class="xref"><b>Paragraph 43</b></a>
                supports VML 
                - vector markup language - as vector graphic language in the Internet Explorer. 
                Early in the development process of JSXGraph we decided to support SVG and VML directly, without using one of their
                existing abstraction layers. The reason was performance, the existing layers were too slow at that time.
            </p>
            <p xmlns="">
                SVG and VML are similar in many aspects, but different in many details. In order to realize visual properties VML makes heavily use of
                subnodes of XML nodes. SVG uses mostly attributes for the same visual properties.
                But overall the differences are not too large. The JSXGraph source contains two files SVGRenderer.js and VMLRenderer.js which handle 
                different language features. Each file consists of about 700 lines including comments.
            </p>
            <p xmlns="">
                In SVG JSXGraph rarely uses CSS formatting.  The reason is that in the beginning of the development process
                the use of CSS styles consumed to much computing resources, especially setting opacity with Firefox. 
                So, nearly all visual properties are realized with attributes and filters. But filters in SVG are still not 
                implemented satisfactorily. Since version 0.76 JSXGraph supports shadows and gradients. 
                The SVG filter to display lines, circles and points with shadows is implemented dynamically with the following
                commands. 
                <table class="codeBlock"><tr><td><pre>
    this.defs = this.container.ownerDocument.createElementNS(this.svgNamespace,'defs');
    this.svgRoot.appendChild(this.defs);
    this.filter = this.container.ownerDocument.createElementNS(this.svgNamespace,'filter');
    this.filter.setAttributeNS(null, 'id', 'f1');
    this.filter.setAttributeNS(null, 'width', '300%');
    this.filter.setAttributeNS(null, 'height', '300%');
    this.feOffset = this.container.ownerDocument.createElementNS(this.svgNamespace,'feOffset');
    this.feOffset.setAttributeNS(null, 'result', 'offOut');
    this.feOffset.setAttributeNS(null, 'in', 'SourceAlpha');
    this.feOffset.setAttributeNS(null, 'dx', '5');
    this.feOffset.setAttributeNS(null, 'dy', '5');
    this.filter.appendChild(this.feOffset);
    this.feGaussianBlur = this.container.ownerDocument.createElementNS(this.svgNamespace,'feGaussianBlur');
    this.feGaussianBlur.setAttributeNS(null, 'result', 'blurOut');
    this.feGaussianBlur.setAttributeNS(null, 'in', 'offOut');
    this.feGaussianBlur.setAttributeNS(null, 'stdDeviation', '3');
    this.filter.appendChild(this.feGaussianBlur);
    this.feBlend = this.container.ownerDocument.createElementNS(this.svgNamespace,'feBlend');
    this.feBlend.setAttributeNS(null, 'in', 'SourceGraphic');
    this.feBlend.setAttributeNS(null, 'in2', 'blurOut');
    this.feBlend.setAttributeNS(null, 'mode', 'normal');
    this.filter.appendChild(this.feBlend);
    this.defs.appendChild(this.filter);</pre></td></tr></table>
                At the time of writing shadows slow down the browser considerably on the Firefox. Further, there seems to be a bug for
                horizontal and vertical lines. In these cases no shadows are displayed.
                In Webkit based browsers like Chrome and Safari these filters are not implemented, yet. In Opera it looks ugly.
                VML realizes shadows as a subnode. There, no noticable speed reduction is observable.
            </p>
         
        
            <h3 xmlns=""><a id="S"> HTML elements</a></h3>
            <p xmlns="">
                For the display of text, like labels of points or results of computations, JSXGraph does not use the text element of SVG.
                Instead, div tags in HTML are used. That means the browsers display the text as HTML elements above the SVG image. 
                In order to update the text the innerHTML property of HTML is used. This is slow, but since many texts are never changed,
                it is used rarely.
                We decided to use HTML elements for SVG, because 
                </p><ul class="bulleted"><li>at that time HTML tags and HTML entities in texts were not supported 
                        in the Firefox implementation, 
                        </li><li>VML does not contain a text  element. Therefore, we do not need to distinguish SVG and VML 
                        for texts.
                        </li></ul><p></p>
          
        
            <h3 xmlns=""><a id="S"> Speed improvements</a></h3>
            <p xmlns="">
                In order to make a fast enough reaction to user interaction like mouse move possible, JSXGraph contains many 
                tricks to speed up the computations. Special care about implementation details is still necessary, even if the
                JavaScript interpreters, respectively Just-in-time-compilers, have made huge progress since the development of JSXGraph 
                has been started.
                Here, we list a few of the tricks of the trade, which proved to be useful. Of course, the benefits 
                of most of these tricks depend on the browser implementations and may change with new versions of the browsers.
            </p>
            
                <h4 xmlns=""><a id="S"> Avoid DOM accesses with getElementById()</a></h4>
                <p xmlns="">When a new SVG node is created, a reference to the DOM node 
                    is safed internally. Later on, access to this node is realized via this pointer variable, exclusively.
                    Using getElementById() or the $() operator of prototype.js or jquery.js proved to be much too slow.
                 </p>
            
            
                <h4 xmlns=""><a id="S"> Suspend the update of SVG nodes</a></h4>
                <p xmlns="">
                        Before a construction is updated, triggered by a mouse move or mouse up event, the redrawing 
                        of the SVG nodes is suspended, until the position of all elements has been recalculated.
                        Then, the redrawing of the SVG nodes is forced.
                <table class="codeBlock"><tr><td><pre>
    this.suspendHandle = this.svgRoot.suspendRedraw(10000);
    // Expensive recalculations ...
    this.svgRoot.unsuspendRedraw(this.suspendHandle);
    this.svgRoot.forceRedraw();</pre></td></tr></table>
                        This seems to speed up at least the linux version of Firefox considerably.                 
                </p>
            
            
                <h4 xmlns=""><a id="S"> Use memoizers</a></h4>
                <p xmlns="">
                        Common functions like binomial() and factorial() are realized with memoizer techniques, 
                        as descripted in <a href="#Crockford2008" class="xref"><b>Paragraph 43</b></a>, page 44.
                        Thus, the expensive computation of each value of these functions is done only once.
                 </p>
            
            
                <h4 xmlns=""><a id="S"> Distinguish mouse move and mouse up events</a></h4>
                <p xmlns="">
                    For curves there are  A very special, but decisive speed improvement has been done for the Internet Explorer version 6 and 7. With the following piece of code which is executed at initialization time the update speed of the Internet Explorer has been improved by an order of magnitude. two update modes, resulting in different quality in output. During the update following a
                    mouse move event, a curve is plotted evaluating only few data points. The default value here is to use 400 points.
                    In the update follwoing a mouse up event the same curve is plotted with much more points. The default value
                    now is to use 2000 points. These values can be adapted in Options.js.                 
                </p>
            
            
                <h4 xmlns=""><a id="S"> Reduce the download and initialization time</a></h4>
                <p xmlns="">
                    The JavaScript source code of 
                    JSXGraph version 0.76 consists of 20 individual files, which add up to about 980 kBytes including comments.
                    These 20 files are bundled together in one big file which is subsequently compressed by the 
                    YUI compressor<a href="#FT13" class="fnref"><b>[13]</b></a> from Yahoo!. 
                    During this process comments and superfluous whitespace are removed. The resulting file jsxgraphcore.js
                    only consists of 380 kBytes. If the web server which delivers jsxgraphcore.js has DEFLATE enabled, which means it
                    compresses its output additionally with gzip, the web browser has to download about 80 kByte. 
                    In most cases, this is less than the same construction would take as non-interactive PNG image.
                </p>
            
            
                <h4 xmlns=""><a id="S"> Use the function invocation pattern</a></h4>
                <p xmlns="">
                Sometimes function graphs are expensive to compute. One example is a regression polynomial through 
                a given set of points. On update the position of all points has to be determined, the resulting linear system of
                equations has to solved. Its solutions gives the coefficients of the polynomial.
                We certainly do not want to do this computation for determining a single function value, since for one update 
                of the function graph we have to compute more than a thousand values of that function.
                </p>
                <p xmlns="">
                We apply the following strategy: When the function graph is updated, we compute the coefficients of the polynomial once.
                Then we use these coefficients for the computation of all function values.
                But where to store the coefficients. Using the "this" keyword does not give the desired results in a function.
                But fortunately, we can use the function invocation pattern, see <a href="#Crockford2008" class="xref"><b>Paragraph 43</b></a>, page 28.
                In the example below, the function which is returned by the call of "generateFunction()" still has access to the 
                variable "coeffs". This is based on the powerful concept of closures, which is part of JavaScript and comes from 
                functional programming languages.
                So, we can compute many function values very fast, and we do not have to do the bookkeeping, where these
                coefficients are stored.
                <div class="figure"><table class="codeBlock"><tr><td><pre>     
generateFunction = function(degree,dataX,dataY) { 
    var coeffs = [];                 
    var fct = function(x,suspendedUpdate){
            var i, j, M, MT, y, B, c, s,
                len = dataX.length;                       
                
            if (!suspendedUpdate) {  // Recomputation of the cooefficents: expensive
                M = [];
                for (j=0;j&lt;len;j++) {
                    M.push([1]);
                }
                for (i=1;i&lt;=degree;i++) {
                    for (j=0;j&lt;len;j++) {
                        M[j][i] = M[j][i-1]*datax[j];  
                    }
                }
                y = dataY;                       
                MT = JXG.Math.Matrix.transpose(M);

                B = JXG.Math.matMatMult(MT,M);
                c = JXG.Math.matVecMult(MT,y);
                coeffs = JXG.Math.Numerics.Gauss(B, c);
                
            }
            
            // Horner's scheme to evaluate polynomial: cheap
            s = coeffs[degree];
            for (i=degree-1;i&gt;=0;i--) {
                s = (s*x+coeffs[i]);
            }
            return s;
        };
        return fct;
    };
                </pre></td></tr></table><blockquote class="figureTitle"><p><b>Example 3: Use of the function invocation pattern</b></p></blockquote></div></p>
            
            
                <h4 xmlns=""><a id="S"> An Internet Explorer trick</a></h4>
                <p xmlns="">
                    A very special, but decisive speed improvement has been done for the Internet Explorer version 6 and 7.  
                     With the following piece of code which is executed at initialization time the update speed of the Internet Explorer has been improved by an order of magnitude.
                <table class="codeBlock"><tr><td><pre>    
    function MouseMove(e) {
        document.body.scrollLeft;
        document.body.scrollTop;
    }
    document.onmousemove = MouseMove;</pre></td></tr></table>
                    We are not aware that this trick has been mentioned before anywhere else.
                </p>
            
          
    <h2 xmlns="" class="bibliogHeader"><a id="S.Bibliography">Bibliography</a></h2><dl xmlns="" class="bibliog">Books
            
                Crockford2008
                
                    
                        Douglas. Crockford
                    
                
                978-0-596-51774-8
                
                    O'Reilly
                
                JavvaScript: The Good Parts
            

            
                VML1998
                
                    John Bowler
                    Howard Cooperstein
                    Brian Dister
                    Ajay Jindal
                    Daniel Lee
                    Brian Mathews
                    Tuan Nguyen
                    Troy Sandal
                    Peter Wu
                
                1998
                    W3C
                
                
                    http://www.w3.org/TR/1998/NOTE-VML-19980513
                
                Vector Markup Language (VML)
            

            
            
            
                AhoSethiUllman96
                
                    
                        Alfred V. Aho
                    
                    
                        Ravi Sethi
                    
                    
                        Jeffrey D. Ullman
                    
                
                1996
                    Bell Telephone Laboratories, Inc.
                
                    James T. DeWolf
                
                0-201-10088-6
                
                    Addison-Wesley Publishing Company
                
                Compilers, Principles, Techniques, and Tools
            
            
            
                
                    
                        Andrea Bahadur
                    
                    
                        Mark Shwarek
                    
                
                19741975
                    Product Development International Holding N. V.
                
                0-88459-021-6
                
                    Plenary Publications International, Inc.
                
                Kites
                Ancient Craft to Modern Sport
                988-999
            
            
        Periodicals
            
            
                Walsh97
                
                    XML: Principles, Tools, and Techniques
                    
                        O'Reilly &amp; Associates, Inc.
                    
                    1085-2301
                    
                        Dan Connolly
                    
                
                
                    A Guide to XML
                    
                         WalshNorman
                    
                    1997ArborText, Inc.
                    97-108
                
            
            
        </dl><h2 xmlns="" class="ftnoteHeader"><a id="S.Footnotes">Footnotes</a></h2><ol xmlns="" class="ftnote"><li><p><a id="FT1"/>http://jsxgraph.org</p></li><li><p><a id="FT2"/>Inspired by the work of Sam Ruby: 
            http://intertwingly.net/blog/2006/07/06/Penrose-Tiling</p></li><li><p><a id="FT3"/>http://geonext.de</p></li><li><p><a id="FT4"/>http://i2geo.net</p></li><li><p><a id="FT5"/>http://geogebra.org</p></li><li><p><a id="FT6"/>http://jsxgraph.uni-bayreuth.de/wiki/index.php/SIR_model:_swine_flu</p></li><li><p><a id="FT7"/>http://jsxgraph.uni-bayreuth.de/wiki/index.php/Analyze_data_with_the_Statistics_software_R</p></li><li><p><a id="FT8"/>http://prototypejs.org</p></li><li><p><a id="FT9"/>http://jquery.com</p></li><li><p><a id="FT10"/>http://prototypejs.org</p></li><li><p><a id="FT11"/>http://jquery.com</p></li><li><p><a id="FT12"/>See http://www.w3.org/TR/1998/NOTE-VML-19980513 for the specification.</p></li><li><p><a id="FT13"/>http://developer.yahoo.com/yui/compressor/</p></li></ol><p class="credits"><small>XHTML rendition made possible by
      <a href="http://www.schemasoft.com">SchemaSoft</a>'s
      <a href="http://www.schemasoft.com/DocBook/">Document Interpreter</a>&trade;
      technology.</small></p></body></html>
