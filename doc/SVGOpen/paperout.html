<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns="">Interactive SVG with JSXGraph</title><meta xmlns="" name="keywords" content="conference proceedings, paper formats"/><meta xmlns="" name="author" content="Bianca Valentin"/><meta xmlns="" name="author" content="Michael Gerhaeuser"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Content-Style-Type" content="text/css"/><style type="text/css">
ul.simple {list-style-type: none}
ul.bulleted {list-style-type: disc}
ul.openBulleted {list-style-type: circle}
ul.dashed {list-style-type: square}
ol.arabic {list-style-type: decimal}
ol.ualpha {list-style-type: upper-alpha}
ol.uroman {list-style-type: upper-roman}
ol.lalpha {list-style-type: lower-alpha}
ol.lroman {list-style-type: lower-roman}
ol.ftnote {list-style-type: decimal}
    </style><link rel="stylesheet" type="text/css" href="http://www.svgopen.org/2008/docbook/ideadb.css"/></head><body><h1 xmlns="" class="title">Interactive SVG with JSXGraph</h1><h2 xmlns="" class="subt">JSXGraph</h2><p xmlns="" class="keyword"><i class="keywordHeader">Keywords: </i><a id="K1.conference.proceedings" title="conference proceedings"/>conference proceedings, <a id="K2.paper.formats" title="paper formats"/>paper formats</p><p xmlns="" class="author"><span class="authorName">Bianca Valentin</span><br/>PhD student<br/><br/>University of Bayreuth<br/>Department of mathematics<br/>
                            <br/>Bayreuth
                            <br/>Universitaetsstr. 30
                            <br/>95444
                            <br/>Germany
                            <br/>++49-921 55 3389
                        </p><p xmlns="" class="bioHeader"><i>Biography</i></p><blockquote xmlns="" class="bio"><p>Bla bla</p></blockquote><p xmlns="" class="author"><span class="authorName">Michael Gerhaeuser</span><br/>Student<br/><br/>University of Bayreuth<br/>Department of mathematics<br/>
                            <br/>Bayreuth
                            <br/>Universitaetsstr. 30
                            <br/>95444
                            <br/>Germany
                            <br/>
                        </p><p xmlns="" class="bioHeader"><i>Biography</i></p><blockquote xmlns="" class="bio"><p>Bla bla</p></blockquote><hr xmlns="" class="upperBorder"/><h2 xmlns="" class="abstractHeader">Abstract</h2><hr xmlns="" class="lowerBorder"/><div xmlns="" class="abstract"><p>JSXGraph is a client-side web library for displaying interactive mathematics and drawings in a web browser. This article shall demonstrate the possibilities of JSXGraph and explain how they are implemented.</p></div><hr class="upperBorder"/><h2 class="tocHeader">Table of Contents</h2><hr class="lowerBorder"/><p class="toc"><b xmlns=""><a href="#S1.">1. Introduction</a></b><br xmlns=""/><b xmlns=""><a href="#S2.">2. Mathematics</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.1">2.1 JSXGraph as a web viewer for dynamic geometry software</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.2">2.2 Currently supported file formats</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.3">2.3 Constructing from scratch</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S2.4">2.4 Calculus</a><br xmlns=""/><b xmlns=""><a href="#S3.">3. Turtle graphics</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S3.1">3.1 Programming with turtle graphics</a><br xmlns=""/><b xmlns=""><a href="#S4.">4. Charts</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S4.1">4.1 Title of subsubsection</a><br xmlns=""/><b xmlns=""><a href="#S5.">5. JSXGraph as front end to server side applications</a></b><br xmlns=""/><b xmlns=""><a href="#S6.">6. JSXGraph Plugins</a></b><br xmlns=""/><b xmlns=""><a href="#S7.">7. Implementation details</a></b><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S7.1">7.1 SVG vs. VML</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S7.2">7.2 HTML elements</a><br xmlns=""/>
    &nbsp;&nbsp;&nbsp;&nbsp;
  <a xmlns="" href="#S7.3">7.3 Speed improvements</a><br xmlns=""/><b xmlns=""><a href="#S.Bibliography">Bibliography</a></b><br xmlns=""/><b xmlns=""><a href="#S.Footnotes">Footnotes</a></b><br xmlns=""/></p>
        <h2 xmlns=""><a id="S1.">1. Introduction</a></h2>
        <p xmlns="">Para 1</p>
    
        <h2 xmlns=""><a id="S2.">2. Mathematics</a></h2>
        <p xmlns="">The originally intended purpose of JSXGraph was having a JavaScript library for displaying geometric constructions in a web browser. So it is possible to visualize geometric elements that are taught in schools and universities like points, lines, circles, arcs, and angles, as well as predefined composition elements. JSXGraph not only provides tools for displaying geometric constructions but also for doing calculus like plotting curves starting from function graphs with tangents up to parametric and polar curves, splines or other interpolation methods. </p>
        
            <h3 xmlns=""><a id="S"> JSXGraph as a web viewer for dynamic geometry software</a></h3>
            <p xmlns="">Dynamic geometry software (DGS) are computer programs which allow one to create and then manipulate geometric constructions, primarily in plane geometry. In most DGS, one starts construction by putting a few points and using them to define new objects such as lines, circles or other points. After some construction is done, one can move the points one started with and see how the construction changes.</p>
            <p xmlns="">
            There are lots of different available software packages to play around dynamically with geometry at schools and universities. Most of them are written in Java, such as Geogebra, Cinderella, Compass and Ruler or GEONExT, others like The Geometer's Sketchpad or Cabri offer a Java based web viewer. So if you want to integrate a construction that was created with one of these DGS in a web page, it takes some time to load the corresponding Java applet before you can use it. There are moreover big doubts about the future of Java in a web browser because Java applets are vanishing more and more from the internet and are actually not supported in browsers on modern mobile internet devices. As a result, the idea of JSXGraph was to read GEONExT Files and display them in the browser using JavaScript to manage the corresponding DOM elements of SVG or VML, depending on what browser is used. JavaScript is furthermore used to realize the dynamic in DGS by capturing the browser's mouse events. </p>
        
        
            <h3 xmlns=""><a id="S"> Currently supported file formats</a></h3>
            <p xmlns="">Since JSXGraph has evolved from the GEONExT project, the support of its file format is almost complete. 
Other file formats are under development. For example, JSXGraph is involved in the European Intergeo project which shall unite several dynamic geometry softwares (Geogebra, Cabri, GEONExT, Cinderella, etc.) agreeing about a common file format that can be displayed within a browser using the Intergeo reader of JSXGraph. Support for reading Geogebra files directly is under development in cooperation with the Geogebra developers.
            </p>
        
        
            <h3 xmlns=""><a id="S"> Constructing from scratch</a></h3>
            <p xmlns="">The JSXGraph API used in the readers for the different file formats can also be used to create a construction from scratch or to manipulate a construction loaded from a given file. JSXGraph contains functions for compass and ruler constructions in euclidean geometry basing on points, lines, circles, arcs, and angles. Those can be intersected or combined in predefined ways. For example one can construct a line that is parallel to another one or a point that is the midpoint between two other points by using integrated JSXGraph methods. Additionally, one can easily implement own composition elements with JavaScript and the above-mentioned functions. 
            </p>
        
        
            <h3 xmlns=""><a id="S"> Calculus</a></h3>
            <p xmlns="">Beyond the capabilities of JSXGraph with regard to geometric constructions, one is also able to visualize calculus.</p>
            <p xmlns="">The possibilities start from plotting simple functiongraphs to displaying more complex graphs like parametric and polar curves which can be analyzed using the implemented methods for tangents, integrals or spline interpolation. 
            </p>
            <p xmlns="">Example:  examine the influence of function parameters like in code example 1[TODO]</p>
            <p xmlns="">With an implementation of an explicit Runge-Kutta process, JSXGraph can also solve ordinary differential equations on the fly with the opportunity to change the parameters on runtime and watching the results.
            </p>
                    
    
        <h2 xmlns=""><a id="S3.">3. Turtle graphics</a></h2>
        <p xmlns="">Mathematic modelling with differential equations can also be done by using turtle graphics. But turtle graphics have their own appeal, too.</p>
        
            <h3 xmlns=""><a id="S"> Programming with turtle graphics</a></h3>
            <p xmlns="">With turtle graphics one can easily produce beautiful Lindenmayer systems like plants, penrose tilings, the Sierpinski triangle or the Koch curve. Moreover, abecedarian games like snake can be implemented in a few lines.</p>
        
    
        <h2 xmlns=""><a id="S4.">4. Charts</a></h2>
        <p xmlns="">Having all the geometric objects with all their possibilities within JSXGraph, it was not difficult to integrate support for charts which provide all the optical properties that are integrated in JSXGraph. So it is possible to create easily dynamic bar charts or interactive pie charts.</p>
        
        
            <h3 xmlns=""><a id="S"> Title of subsubsection</a></h3>
            <p xmlns="">A paragraph ...</p>
        
    
        <h2 xmlns=""><a id="S5.">5. JSXGraph as front end to server side applications</a></h2>
        <p xmlns=""> A paragraph ...</p>          
    
        <h2 xmlns=""><a id="S6.">6. JSXGraph Plugins</a></h2>
        <p xmlns=""> Para 1</p>
    
        <h2 xmlns=""><a id="S7.">7. Implementation details</a></h2>
        <p xmlns="">
            The main focus of JSXGraph is on interactivity. The user should experience immediate response to the dragging of points
            with the mouse. So, special care had to be spent on fast reacting to the mouse move events and mouse up events. Contrarily
            we want to exploit the superb output quality of vector graphics. These two controversial goals - 
            speed versus quality - have to be balanced. 
        </p> 
        <p xmlns="">
            For the browser abstraction JSXGraph uses either the Prototype JavaScript library<a href="#FT1" class="fnref"><b>[1]</b></a> 
            or 
            jQuery<a href="#FT2" class="fnref"><b>[2]</b></a>.  
            JSXGraph can be used with either of these two libraries equally good. 
            The access to these libraries is restricted to a minimum and it is capsuled in a few lines in the
            source code file jsxgraph.js. These libraries are nerly exclusively used for the corss-browser handling of events.
            Everything else in JSXGraph is built up from scratch and does not rely on third-party libraries.
            So, it should be easy to port JSXGraph to a further framework, if necessary.
        </p>
        
            <h3 xmlns=""><a id="S"> SVG vs. VML</a></h3>
            <p xmlns="">
                One of the major user audiences of JSXGraph are schools. In general, schools are adapting only slowly to new technologies.
                That is one of the reason, why Internet Explorer is widely used in schools. Since we can not afford to exclude schools as
                users of JSXGraph we had to adapt it to the Internet Explorer, too. Since the year 1998 
                Microsoft<a href="#FT3" class="fnref"><b>[3]</b></a><a href="#VML98" class="xref"><b>Paragraph 26</b></a>
                supports VML 
                - vector markup language - as vector graphic language in the Internet Explorer. 
                Early in the development process of JSXGraph we decided to support SVG and VML directly, without using one of their
                existing abstraction layers. The reason was performance, the existing layers were too slow at that time.
            </p>
            <p xmlns="">
                SVG and VML are similar in many aspects, but different in many details. In order to realize visual properties VML makes heavily use of
                subnodes of XML nodes. SVG uses mostly attributes for the same visual properties.
                But overall the differences are not too large. The JSXGraph source contains two files SVGRenderer.js and VMLRenderer.js which handle 
                different language features. Each file consists of about 700 lines including comments.
            </p>
            <p xmlns="">
                In SVG JSXGraph rarely uses CSS formatting.  The reason is that in the beginning of the development process
                the use of CSS styles consumed to much computing resources, especially setting opacity with Firefox. 
                So, nearly all visual properties are realized with attributes and filters. But filters in SVG are still not 
                implemented satisfactorily. Since version 0.76 JSXGraph supports shadows and gradients. 
                The SVG filter to display lines, circles and points with shadows is implemented dynamically with the following
                commands.
                <table class="codeBlock"><tr><td><pre>
    this.defs = this.container.ownerDocument.createElementNS(this.svgNamespace,'defs');
    this.svgRoot.appendChild(this.defs);
    this.filter = this.container.ownerDocument.createElementNS(this.svgNamespace,'filter');
    this.filter.setAttributeNS(null, 'id', 'f1');
    this.filter.setAttributeNS(null, 'width', '300%');
    this.filter.setAttributeNS(null, 'height', '300%');
    this.feOffset = this.container.ownerDocument.createElementNS(this.svgNamespace,'feOffset');
    this.feOffset.setAttributeNS(null, 'result', 'offOut');
    this.feOffset.setAttributeNS(null, 'in', 'SourceAlpha');
    this.feOffset.setAttributeNS(null, 'dx', '5');
    this.feOffset.setAttributeNS(null, 'dy', '5');
    this.filter.appendChild(this.feOffset);
    this.feGaussianBlur = this.container.ownerDocument.createElementNS(this.svgNamespace,'feGaussianBlur');
    this.feGaussianBlur.setAttributeNS(null, 'result', 'blurOut');
    this.feGaussianBlur.setAttributeNS(null, 'in', 'offOut');
    this.feGaussianBlur.setAttributeNS(null, 'stdDeviation', '3');
    this.filter.appendChild(this.feGaussianBlur);
    this.feBlend = this.container.ownerDocument.createElementNS(this.svgNamespace,'feBlend');
    this.feBlend.setAttributeNS(null, 'in', 'SourceGraphic');
    this.feBlend.setAttributeNS(null, 'in2', 'blurOut');
    this.feBlend.setAttributeNS(null, 'mode', 'normal');
    this.filter.appendChild(this.feBlend);
    this.defs.appendChild(this.filter);</pre></td></tr></table>
                At the time of writing shadows slow down the browser considerably on the Firefox. Further, there seems to be a bug for
                horizontal and vertical lines. In these cases no shadows are displayed.
                In Webkit based browsers like Chrome and Safari these filters are not implemented, yet. In Opera it looks ugly.
                VML realizes shadows as a subnode. There, no noticable speed reduction is observable.
            </p>
         
        
            <h3 xmlns=""><a id="S"> HTML elements</a></h3>
            <p xmlns="">
                For the display of text, like labels of points or results of computations, JSXGraph does not use the text element of SVG.
                Instead, div tags in HTML are used. That means the browsers display the text as HTML elements above the SVG image. 
                In order to update the text the innerHTML property of HTML is used. This is slow, but since many texts are never changed,
                it is used rarely.
                We decided to use HTML elements for SVG, because 
                </p><ul class="bulleted"><li>at that time HTML tags and HTML entities in texts were not supported 
                        in the Firefox implementation, 
                        </li><li>VML does not contain a text  element. Therefore, we do not need to distinguish SVG and VML 
                        for texts.
                        </li></ul><p></p>
          
        
            <h3 xmlns=""><a id="S"> Speed improvements</a></h3>
            <p xmlns="">
                In order to make a fast enough reaction to user interaction like mouse move possible, JSXGraph contains many 
                tricks to speed up the computations. Special care about implementation details is still necessary, even if the
                JavaScript interpreters, respectively Just-in-time-compilers, have made huge progress since the development of JSXGraph 
                has been started.
                Here, we list a few of the tricks of the trade, which proved to be useful. Of course, the benefits 
                of most of these tricks depend on the browser implementations and may change with new versions of the browsers.
                </p><ul class="bulleted"><li>Avoid DOM accesses with getElementById(). When a new SVG node is created, a reference to the DOM node 
                        is safed internally. Later on, access to this node is realized via this pointer variable, exclusively.
                        Using the $() operator of prototype.js or jquery.js proved to be much too slow.
                    </li><li>Before a construction is updated, triggered by a mouse move or mouse up event, the redrawing 
                        of the SVG nodes is suspended, until the position of all elements has been recalculated.
                        Then, the redrawing of the SVG nodes is forced.
                <table class="codeBlock"><tr><td><pre>
    this.suspendHandle = this.svgRoot.suspendRedraw(10000);
    // Expensive recalculations ...
    this.svgRoot.unsuspendRedraw(this.suspendHandle);
    this.svgRoot.forceRedraw();</pre></td></tr></table>
                    This seems to speed up at least the linux version of Firefox considerably.
                    </li><li>Common functions like binomial() and factorial() are realized with memoizer techniques, 
                        as descripted in <a href="#Crockford2008" class="xref"><b>Paragraph 26</b></a>, page 44.
                        Thus, the expensive computation of each value of these functions is done only once.
                    </li><li>For curves there are two update modes, resulting in different quality in output: During the update following a
                        mouse move event, a curve is plotted evaluationg only few data points. The default value is 400 points.
                        In the update follwoing a mouse up event the same curve is plotted with much more points. The default value
                        now is 200 points. These values can be adapted in Options.js.
                        </li><li>Reducing the download and initalization time: The JavaScript source code of 
                        JSXGraph version 0.76 consists of 20 files, which add up to about 980 kBytes including comments.
                        These 20 files are bundled together in one big file which is subsequently compressed by the 
                        YUI compressor<a href="#FT4" class="fnref"><b>[4]</b></a>. During this process comments and superfluous whitespace are removed. The resulting file jsxgraphcore.js
                        only consists of 380 kBytes. If the web server which delivers jsxgraphcore.js has DEFLATE enabled, which means it
                        compresses its output additionally with gzip, the web browser has to download about 80 kByte. 
                        In most cases, this is less than the same construction would take as non-interactive PNG image.
                        </li><li>A very special, but decisive speed improvement has been done for the Internet Explorer.  
                     </li></ul><p></p>
          
    <h2 xmlns="" class="bibliogHeader"><a id="S.Bibliography">Bibliography</a></h2><dl xmlns="" class="bibliog">Books
            
                Crockford2008
                
                    
                        Douglas. Crockford
                    
                
                978-0-596-51774-8
                
                    O'Reilly
                
                JavvaScript: The Good Parts
            

            
                VML1998
                
                    John Bowler
                    Howard Cooperstein
                    Brian Dister
                    Ajay Jindal
                    Daniel Lee
                    Brian Mathews
                    Tuan Nguyen
                    Troy Sandal
                    Peter Wu
                
                1998
                    W3C
                
                
                    http://www.w3.org/TR/1998/NOTE-VML-19980513
                
                Vector Markup Language (VML)
            

            
            
            
                AhoSethiUllman96
                
                    
                        Alfred V. Aho
                    
                    
                        Ravi Sethi
                    
                    
                        Jeffrey D. Ullman
                    
                
                1996
                    Bell Telephone Laboratories, Inc.
                
                    James T. DeWolf
                
                0-201-10088-6
                
                    Addison-Wesley Publishing Company
                
                Compilers, Principles, Techniques, and Tools
            
            
            
                
                    
                        Andrea Bahadur
                    
                    
                        Mark Shwarek
                    
                
                19741975
                    Product Development International Holding N. V.
                
                0-88459-021-6
                
                    Plenary Publications International, Inc.
                
                Kites
                Ancient Craft to Modern Sport
                988-999
            
            
        Periodicals
            
            
                Walsh97
                
                    XML: Principles, Tools, and Techniques
                    
                        O'Reilly &amp; Associates, Inc.
                    
                    1085-2301
                    
                        Dan Connolly
                    
                
                
                    A Guide to XML
                    
                         WalshNorman
                    
                    1997ArborText, Inc.
                    97-108
                
            
            
        </dl><h2 xmlns="" class="ftnoteHeader"><a id="S.Footnotes">Footnotes</a></h2><ol xmlns="" class="ftnote"><li><p><a id="FT1"/>http://prototypejs.org</p></li><li><p><a id="FT2"/>http://jquery.com</p></li><li><p><a id="FT3"/>See http://www.w3.org/TR/1998/NOTE-VML-19980513 for the specification.</p></li><li><p><a id="FT4"/>http://developer.yahoo.com/yui/compressor/</p></li></ol><p class="credits"><small>XHTML rendition made possible by
      <a href="http://www.schemasoft.com">SchemaSoft</a>'s
      <a href="http://www.schemasoft.com/DocBook/">Document Interpreter</a>&trade;
      technology.</small></p></body></html>
