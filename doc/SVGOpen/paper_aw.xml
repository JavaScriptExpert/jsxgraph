<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.docbook.org/xml/5.0/rng/docbook.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
    <info>
        <title>Interactive SVG with JSXGraph</title>
        <subtitle>JSXGraph</subtitle>
        <keywordset>
            <keyword>conference proceedings</keyword>
            <keyword>paper formats</keyword>
        </keywordset>
        <authorgroup>
            <author>
                <personname>
                    <firstname>Bianca</firstname>
                    <surname>Valentin</surname>
                </personname>
                <email>bianca.valentin@uni-bayreuth.de</email>
                <personblurb><para>Bla bla</para></personblurb>
                <affiliation>
                    <jobtitle>PhD student</jobtitle>
                    <org>
                        <orgname>University of Bayreuth</orgname>
                        <orgdiv>Department of mathematics</orgdiv>
                        <address>
                            <city>Bayreuth</city>
                            <street>Universitaetsstr. 30</street>
                            <postcode>95444</postcode>
                            <country>Germany</country>
                            <phone>++49-921 55 3389</phone>
                        </address>   
                    </org>
                </affiliation>
            </author>
            <author>
                <personname>
                    <firstname>Michael</firstname>
                    <surname>Gerhaeuser</surname>
                </personname>
                <email>michael.gerhaeuser@gmail.com</email>
                <personblurb><para>Bla bla</para></personblurb>
                <affiliation>
                    <jobtitle>Student</jobtitle>
                    <org>
                        <orgname>University of Bayreuth</orgname>
                        <orgdiv>Department of mathematics</orgdiv>
                        <address>
                            <city>Bayreuth</city>
                            <street>Universitaetsstr. 30</street>
                            <postcode>95444</postcode>
                            <country>Germany</country>
                            <phone></phone>
                        </address>   
                    </org>
                </affiliation>
            </author>            
        </authorgroup>
        <!-- If you have several authors, you could nest all authors within an authorgroup element -->
        <abstract>
            <para>JSXGraph is a client-side web library for displaying interactive mathematics and drawings in a web browser. This article shall demonstrate the possibilities of JSXGraph and explain how they are implemented.</para>
        </abstract>
    </info>
    <section>
        <title>Introduction</title>
        <para>JSXGraph<footnote><para><ulink url="http://jsxgraph.org">http://jsxgraph.org</ulink></para>
                </footnote>  
            is a client-side web application/library for advanced visualizations in a web browser. Its range of application starts from
            the display of simple bar and pie charts to the interactive display of function graphs and Geometry constructions knwon from the good old
            Highschool days. 
            Even more advanced features of JSXGraph are the on-the-fly solving of Differential Equation Systems, the display of 
            Lindenmayer systems<footnote><para>Inspired by the work of Sam Ruby: <ulink url="http://intertwingly.net/blog/2006/07/06/Penrose-Tiling">http://intertwingly.net/blog/2006/07/06/Penrose-Tiling</ulink></para>
            </footnote>, which are of importance in Biology, and dynamic computation of regression polynomials.
        </para>
        <para>
            JSXGraph is a library which may be used in various situations. The main application is to be some kind of a viewer applet for
            educational Mathematics material from schools and universities. 
            Many of these constructions, especially from Euclidean Geometry, are available in some propietary XML file format. Usually they are 
            displayed by some Java applet. In order to compensate the slow demise of Java applets in the web browsers, JSXGraph may prove to be
            useful. At the moment JSXGraph supports the file format of 
            GEONExT<footnote><para><ulink url="http://geonext.de">http://geonext.de</ulink></para></footnote>, 
            Intergeo<footnote><para><ulink url="http://i2geo.net">http://i2geo.net</ulink></para></footnote>, 
            and - at least partially - 
            GeoGebra<footnote><para><ulink url="http://geogebra.org">http://geogebra.org</ulink></para></footnote>.
        </para>
        <para>
            Beside the usage as viewer of existing material, the JSXGraph library may be used as an API for advanced special purpose visualizations.
            JSXGraph enables interactive experiments with sophisticated mathematical models, for example the 
            epidemiology model of the swine flu<footnote><para><ulink url="http://jsxgraph.uni-bayreuth.de/wiki/index.php/SIR_model:_swine_flu">http://jsxgraph.uni-bayreuth.de/wiki/index.php/SIR_model:_swine_flu</ulink></para></footnote>.
            The possibilities of JSXGraph in this respect exceed by far the options offered by software which is common in schools today.
        </para>
        <para>
            Another possible application of JSXGraph is as front end for server based applications. 
            One example is the popular free statistics software R<footnote><para><ulink url="http://jsxgraph.uni-bayreuth.de/wiki/index.php/Analyze_data_with_the_Statistics_software_R">http://jsxgraph.uni-bayreuth.de/wiki/index.php/Analyze_data_with_the_Statistics_software_R</ulink></para></footnote>. On the mouse up event
            data is sent via AJAX to R interface on server side. The result of the computation is sent back to the browser
            and displayed by JSXGraph. 
            JSXGraph can also be used on server side to generate charts - for example with PHP - which are sent to the 
            Browser. The download size of JSXGraph is less than 100 kByte, which is smaller than most bitmap images.
        </para>
        <para>
            From a technical point of view, JSXGraph is implemented in JavaScript. It generates SVG output on Mozilla- and Webkit-based 
            browsers, and VML on the Internet Explorer. 
            Therefore, JSXGraph runs on every modern browser. 
        </para>
        <para>
            JSXGraph is open source software, released under the LGPL â€“ Lesser GNU General Public License. The source code
            is hosted by sourceforge.
        </para>
    </section>
    <section>
        <title>Possibilities of JSXGraph</title>
        <para>Para 1</para>
        <section>
            <title>Mathematics</title>
            <para>The originally intended purpose of JSXGraph was having a JavaScript library for displaying geometric constructions in a web browser. So it is possible to visualize almost everything that is taught in schools and universities with points, lines, circles, arcs, polygones, ... as well as predefined constructed elements as perpendicular lines or circumcircles. But there is not only the possibility of displaying geometry but also lots of tools for doing analysis with plotting curves starting from function graphs with tangents up to parametric and polar curves together with splines or other interpolation methods. </para>
            <section>
                <title>On- and offline reading of files from dynamic geometry software (DGS)</title>
                <para>There is lots of different available software to play around with geometry at schools or universities. Most of them are based on Java, such as Geogebra, Cinderella, Compass and Ruler, Geometer's Sketchpad or GEONExT, so if you want to use these constructions in a web page, it takes some time to load the corresponding Java applet before you can use it. As there are moreover big doubts about the future of Java in a web browser, the idea of JSXGraph was to read GEONExT Files and display them in the browser using JavaScript to manipulate the corrisponding DOM elements of SVG and VML, depending on what browser is used. </para>
                <para>It is furthermore prossible to control the construction by mouse movements like in any other dynamic geometry software. So JSXGraph contains functions for almost anything in euclidean geometry basing on points, lines, circles, arcs and polygones. Those can be intersected or constructed in predefined ways like for example a line that is parallel to another one or a point that is the midpoint between two other points. </para>
                <para>In addition, JSXGraph uses the style properties that are offered by SVG and VML, so that the geometric objects can be displayed in different colors and styles that can be changed on runtime.
                </para>
                <para>As JSXGraph can also display geometric constructions independently from any file format by constructing them 'by hand' with JavaScript, it is useful for the European Intergeo project which shall unite several dynamic geometry softwares (Geogebra, Cabri, Geonext, Cinderella, ...) agreeing about a common file format that can be displayed within a browser using the Intergeo reader of JSXGraph. Another reader for reading Geogebra files directly is under development together with the developers of Geogebra.
                </para>
            </section>
            <section>
                <title>Modelling</title>
                <para>Today, dynamic geometry software is no longer restricted to geometry, but is also able to display analytic content.</para>
                <para>Starting with the easiest way of doing analysis, it may be useful (not only) for schools to plot functiongraphs to visualize the influence of their parameters. JSXGraph is able to plot these functions, but can display also parametric and polar curves which can be analysed using the implemented methods for tangents, integrals or spline interpolation. 
                </para>
                <para>With an implementation of an explicit Runge-Kutta process, JSXGraph can also solve ordinary differential equations on the fly with the opportunity to change the parameters on runtime and watching the results.
                </para>
            </section>            
        </section>
        <section>
            <title>Turtle graphics</title>
            <para>Mathematic modelling with differential equations can also be done by using turtle graphics. But turtle graphics have their own appeal, too.</para>
            <section>
                <title>Programming with turtle graphics</title>
                <para>With turtle graphics one can easily produce beautiful Lindenmayer systems like plants, penrose tilings, the Sierpinski triangle or the Koch curve. Moreover, abecedarian games like snake can be implemented in a few lines.</para>
            </section>
        </section>
        <section>
            <title>Charts</title>
            <para>Having all the geometric objects with all their possibilities within JSXGraph, it was not difficult to integrate support for charts which provide all the optical properties that are integrated in JSXGraph. So it is possible to create easily dynamic bar charts or interactive pie charts.</para>
            <section>
                <title>Title of subsubsection</title>
                <para>A paragraph ...</para>
            </section>
        </section>        
    </section>
    <section>
        <title>Using JSXGraph with a connection to a server</title>
        <para> A paragraph ...</para>          
    </section>
    
    <section>
        <title>Implementation details</title>
        <para>
            The main focus of JSXGraph is on interactivity. The user should experience immediate response to the dragging of points
            with the mouse. So, special care had to be spent on fast reacting to the mouse move events and mouse up events. Contrarily
            we want to exploit the superb output quality of vector graphics. These two controversial goals - 
            speed versus quality - have to be balanced. 
        </para> 
        <para>
            For the browser abstraction JSXGraph uses either the Prototype JavaScript library<footnote><para><ulink url="http://prototypejs.org">http://prototypejs.org</ulink></para>
                </footnote> 
            or 
            jQuery<footnote><para><ulink url="http://jquery.com">http://jquery.com</ulink></para>
                </footnote>.  
            JSXGraph can be used with either of these two libraries equally good. 
            The access to these libraries is restricted to a minimum and it is capsuled in a few lines in the
            source code file jsxgraph.js. These libraries are nerly exclusively used for the corss-browser handling of events.
            Everything else in JSXGraph is built up from scratch and does not rely on third-party libraries.
            So, it should be easy to port JSXGraph to a further framework, if necessary.
        </para>
        <section>
            <title>SVG vs. VML</title>
            <para>
                One of the major user audiences of JSXGraph are schools. In general, schools are adapting only slowly to new technologies.
                That is one of the reason, why Internet Explorer is widely used in schools. Since we can not afford to exclude schools as
                users of JSXGraph we had to adapt it to the Internet Explorer, too. Since the year 1998 
                Microsoft<footnote><para>See <ulink url="http://www.w3.org/TR/1998/NOTE-VML-19980513">http://www.w3.org/TR/1998/NOTE-VML-19980513</ulink> for the specification.</para>
                </footnote> <xref  linkend="VML98"/>
                supports VML 
                - vector markup language - as vector graphic language in the Internet Explorer. 
                Early in the development process of JSXGraph we decided to support SVG and VML directly, without using one of their
                existing abstraction layers. The reason was performance, the existing layers were too slow at that time.
            </para>
            <para>
                SVG and VML are similar in many aspects, but different in many details. In order to realize visual properties VML makes heavily use of
                subnodes of XML nodes. SVG uses mostly attributes for the same visual properties.
                But overall the differences are not too large. The JSXGraph source contains two files SVGRenderer.js and VMLRenderer.js which handle 
                different language features. Each file consists of about 700 lines including comments.
            </para>
            <para>
                In SVG JSXGraph rarely uses CSS formatting.  The reason is that in the beginning of the development process
                the use of CSS styles consumed to much computing resources, especially setting opacity with Firefox. 
                So, nearly all visual properties are realized with attributes and filters. But filters in SVG are still not 
                implemented satisfactorily. Since version 0.76 JSXGraph supports shadows and gradients. 
                The SVG filter to display lines, circles and points with shadows is implemented dynamically with the following
                commands. 
                <programlisting><![CDATA[
    this.defs = this.container.ownerDocument.createElementNS(this.svgNamespace,'defs');
    this.svgRoot.appendChild(this.defs);
    this.filter = this.container.ownerDocument.createElementNS(this.svgNamespace,'filter');
    this.filter.setAttributeNS(null, 'id', 'f1');
    this.filter.setAttributeNS(null, 'width', '300%');
    this.filter.setAttributeNS(null, 'height', '300%');
    this.feOffset = this.container.ownerDocument.createElementNS(this.svgNamespace,'feOffset');
    this.feOffset.setAttributeNS(null, 'result', 'offOut');
    this.feOffset.setAttributeNS(null, 'in', 'SourceAlpha');
    this.feOffset.setAttributeNS(null, 'dx', '5');
    this.feOffset.setAttributeNS(null, 'dy', '5');
    this.filter.appendChild(this.feOffset);
    this.feGaussianBlur = this.container.ownerDocument.createElementNS(this.svgNamespace,'feGaussianBlur');
    this.feGaussianBlur.setAttributeNS(null, 'result', 'blurOut');
    this.feGaussianBlur.setAttributeNS(null, 'in', 'offOut');
    this.feGaussianBlur.setAttributeNS(null, 'stdDeviation', '3');
    this.filter.appendChild(this.feGaussianBlur);
    this.feBlend = this.container.ownerDocument.createElementNS(this.svgNamespace,'feBlend');
    this.feBlend.setAttributeNS(null, 'in', 'SourceGraphic');
    this.feBlend.setAttributeNS(null, 'in2', 'blurOut');
    this.feBlend.setAttributeNS(null, 'mode', 'normal');
    this.filter.appendChild(this.feBlend);
    this.defs.appendChild(this.filter);]]></programlisting>
                At the time of writing shadows slow down the browser considerably on the Firefox. Further, there seems to be a bug for
                horizontal and vertical lines. In these cases no shadows are displayed.
                In Webkit based browsers like Chrome and Safari these filters are not implemented, yet. In Opera it looks ugly.
                VML realizes shadows as a subnode. There, no noticable speed reduction is observable.
            </para>
        </section> 
        <section>
            <title>HTML elements</title>
            <para>
                For the display of text, like labels of points or results of computations, JSXGraph does not use the text element of SVG.
                Instead, div tags in HTML are used. That means the browsers display the text as HTML elements above the SVG image. 
                In order to update the text the innerHTML property of HTML is used. This is slow, but since many texts are never changed,
                it is used rarely.
                We decided to use HTML elements for SVG, because 
                <itemizedlist>
                    <listitem>at that time HTML tags and HTML entities in texts were not supported 
                        in the Firefox implementation, 
                        </listitem>
                    <listitem>VML does not contain a text  element. Therefore, we do not need to distinguish SVG and VML 
                        for texts.
                        </listitem>
                </itemizedlist>
            </para>
        </section>  
        <section>
            <title>Speed improvements</title>
            <para>
                In order to make a fast enough reaction to user interaction like mouse move possible, JSXGraph contains many 
                tricks to speed up the computations. Special care about implementation details is still necessary, even if the
                JavaScript interpreters, respectively Just-in-time-compilers, have made huge progress since the development of JSXGraph 
                has been started.
                Here, we list a few of the tricks of the trade, which proved to be useful. Of course, the benefits 
                of most of these tricks depend on the browser implementations and may change with new versions of the browsers.
            </para>
            <section>
                <title>Avoid DOM accesses with getElementById()</title>
                <para>When a new SVG node is created, a reference to the DOM node 
                    is safed internally. Later on, access to this node is realized via this pointer variable, exclusively.
                    Using getElementById() or the $() operator of prototype.js or jquery.js proved to be much too slow.
                 </para>
            </section>
            <section>
                <title>Suspend the update of SVG nodes</title>
                <para>
                        Before a construction is updated, triggered by a mouse move or mouse up event, the redrawing 
                        of the SVG nodes is suspended, until the position of all elements has been recalculated.
                        Then, the redrawing of the SVG nodes is forced.
                <programlisting><![CDATA[
    this.suspendHandle = this.svgRoot.suspendRedraw(10000);
    // Expensive recalculations ...
    this.svgRoot.unsuspendRedraw(this.suspendHandle);
    this.svgRoot.forceRedraw();]]></programlisting>
                        This seems to speed up at least the linux version of Firefox considerably.                 
                </para>
            </section>
            <section>
                <title>Use memoizers</title>
                <para>
                        Common functions like binomial() and factorial() are realized with memoizer techniques, 
                        as descripted in <xref  linkend="Crockford2008"/>, page 44.
                        Thus, the expensive computation of each value of these functions is done only once.
                 </para>
            </section>
            <section>
                <title>Distinguish mouse move and mouse up events</title>
                <para>
                    For curves there are two update modes, resulting in different quality in output. During the update following a
                    mouse move event, a curve is plotted evaluating only few data points. The default value here is to use 400 points.
                    In the update follwoing a mouse up event the same curve is plotted with much more points. The default value
                    now is to use 2000 points. These values can be adapted in Options.js.                 
                </para>
            </section>
            <section>
                <title>Reduce the download and initialization time</title>
                <para>
                    The JavaScript source code of 
                    JSXGraph version 0.76 consists of 20 files, which add up to about 980 kBytes including comments.
                    These 20 files are bundled together in one big file which is subsequently compressed by the 
                    YUI compressor<footnote><para><ulink url="http://developer.yahoo.com/yui/compressor/">http://developer.yahoo.com/yui/compressor/</ulink></para>
                    </footnote> from Yahoo!. 
                    During this process comments and superfluous whitespace are removed. The resulting file jsxgraphcore.js
                    only consists of 380 kBytes. If the web server which delivers jsxgraphcore.js has DEFLATE enabled, which means it
                    compresses its output additionally with gzip, the web browser has to download about 80 kByte. 
                    In most cases, this is less than the same construction would take as non-interactive PNG image.
                </para>
            </section>
            <section>
                <title>An Internet Explorer trick</title>
                <para>
                    A very special, but decisive speed improvement has been done for the Internet Explorer version 6 and 7.  
                     With the following piece of code which is executed at initialization time the update speed of the Internet Explorer has been improved by an order of magnitude.
                <programlisting><![CDATA[    
    function MouseMove(e) {
        document.body.scrollLeft;
        document.body.scrollTop;
    }
    document.onmousemove = MouseMove;]]></programlisting>
                    We are not aware that this trick has been mentioned before anywhere else.
                </para>
            </section>
        </section>  
    </section>    
    
    <bibliography xmlns="http://docbook.org/ns/docbook">
        <bibliodiv><title>Books</title>

            <biblioentry xml:id="Crockford2008">
                <abbrev>Crockford2008</abbrev>
                <authorgroup>
                    <author><personname>
                        <firstname>Douglas</firstname><surname>Crockford</surname>
                    </personname></author>
                </authorgroup>
                <biblioid class="isbn">978-0-596-51774-8</biblioid>
                <publisher>
                    <publishername>O'Reilly</publishername>
                </publisher>
                <title>JavaScript: The Good Parts</title>
            </biblioentry>

            <biblioentry xml:id="VML98">
                <abbrev>VML1998</abbrev>
                <authorgroup>
                    <author><personname><firstname>John</firstname><surname>Bowler</surname></personname></author>
                    <author><personname><firstname>Howard</firstname><surname>Cooperstein</surname></personname></author>
                    <author><personname><firstname>Brian</firstname><surname>Dister</surname></personname></author>
                    <author><personname><firstname>Ajay</firstname><surname>Jindal</surname></personname></author>
                    <author><personname><firstname>Daniel</firstname><surname>Lee</surname></personname></author>
                    <author><personname><firstname>Brian</firstname><surname>Mathews</surname></personname></author>
                    <author><personname><firstname>Tuan</firstname><surname>Nguyen</surname></personname></author>
                    <author><personname><firstname>Troy</firstname><surname>Sandal</surname></personname></author>
                    <author><personname><firstname>Peter</firstname><surname>Wu</surname></personname></author>
                </authorgroup>
                <copyright><year>1998</year>
                    <holder>W3C</holder></copyright>
                <biblioid class="isbn"></biblioid>
                <publisher>
                    <publishername>http://www.w3.org/TR/1998/NOTE-VML-19980513</publishername>
                </publisher>
                <title>Vector Markup Language (VML)</title>
            </biblioentry>

            <!-- OLD -->
            <biblioentry xml:id="AhoSethiUllman96">
                <abbrev>AhoSethiUllman96</abbrev>
                <authorgroup>
                    <author><personname>
                        <firstname>Alfred V.</firstname><surname>Aho</surname>
                    </personname></author>
                    <author><personname>
                        <firstname>Ravi</firstname><surname>Sethi</surname>
                    </personname></author>
                    <author><personname>
                        <firstname>Jeffrey D.</firstname><surname>Ullman</surname>
                    </personname></author>
                </authorgroup>
                <copyright><year>1996</year>
                    <holder>Bell Telephone Laboratories, Inc.</holder></copyright>
                <editor><personname>
                    <firstname>James T.</firstname><surname>DeWolf</surname>
                </personname></editor>
                <biblioid class="isbn">0-201-10088-6</biblioid>
                <publisher>
                    <publishername>Addison-Wesley Publishing Company</publishername>
                </publisher>
                <title>Compilers, Principles, Techniques, and Tools</title>
            </biblioentry>
            
            <biblioentry xreflabel="Kites75">
                <authorgroup>
                    <author><personname>
                        <firstname>Andrea</firstname><surname>Bahadur</surname>
                    </personname></author>
                    <author><personname>
                        <firstname>Mark</firstname><surname>Shwarek</surname>
                    </personname></author>
                </authorgroup>
                <copyright><year>1974</year><year>1975</year>
                    <holder>Product Development International Holding N. V.</holder>
                </copyright>
                <biblioid class="isbn">0-88459-021-6</biblioid>
                <publisher>
                    <publishername>Plenary Publications International, Inc.</publishername>
                </publisher>
                <title>Kites</title>
                <subtitle>Ancient Craft to Modern Sport</subtitle>
                <pagenums>988-999</pagenums>
            </biblioentry>
            
        </bibliodiv>
        <bibliodiv><title>Periodicals</title>
            
            <biblioentry>
                <abbrev>Walsh97</abbrev>
                <biblioset relation="journal">
                    <title>XML: Principles, Tools, and Techniques</title>
                    <publisher>
                        <publishername>O'Reilly &amp; Associates, Inc.</publishername>
                    </publisher>
                    <biblioid class="issn">1085-2301</biblioid>
                    <editor><personname>
                        <firstname>Dan</firstname><surname>Connolly</surname>
                    </personname></editor>
                </biblioset>
                <biblioset relation="article">
                    <title>A Guide to XML</title>
                    <author><personname>
                        <surname>Walsh</surname><firstname>Norman</firstname>
                    </personname></author>
                    <copyright><year>1997</year><holder>ArborText, Inc.</holder></copyright>
                    <pagenums>97-108</pagenums>
                </biblioset>
            </biblioentry>
            
        </bibliodiv>
        
    </bibliography>
</article>