<html>
<head>
   <title>JSXGraph example</title>
   <link rel="stylesheet" type="text/css" href="../distrib/jsxgraph.css" />
   <script type="text/javascript" src="../distrib/prototype.js"></script>
   <script type="text/javascript" src="../src/loadjsxgraph.js"></script>
   <script type="text/javascript" src="../src/Centroid.js"></script>
   <script type="text/javascript" src="../src/Triangle.js"></script>
</head>
<body>
<h2>Playground to test things temporarily. May change very often.</h2>
<div style="width:800px">
  <div id="jxgbox" class="jxgbox" style="width:600px; height:450px; float:left"></div>
</div>
   <script type="text/javascript">
    /* <![CDATA[ */

board = JXG.JSXGraph.initBoard('jxgbox', {originX: 50, originY: 400, unitX: 25, unitY: 25, axis: false, grid: false});
xax = board.createElement('axis', [[0,0],[1,0]]);
yax = board.createElement('axis', [[0,0],[0,1]]);
p1 = board.createElement('point', [7, 8], {style:2,name:"Q",fixed:true});
p2 = board.createElement('point', [15, 8], {style:2,name:"W",fixed:true});
c1 = board.createElement('circle', [p1, 4.5]);
c2 = board.createElement('circle', [p2, 4.5]);
g1 = board.createElement('glider', [0, 0, c1], {style:5,name:"Drag me"});
c3 = board.createElement('circle', [g1, 8]);
g2 = board.createElement('intersection', [c2,c3,0], {style:5, name: "E"});
g3 = board.createElement('intersection', [c2,c3,1], {style:5, name: "R"});
m1 = board.createElement('midpoint', [g1,g2], {style:8,name:"T",trace:true});
m2 = board.createElement('midpoint', [g1,g3], {style:8,name:"Y",trace:true,strokeColor:'green'});

/*
        board = JXG.JSXGraph.initBoard('jxgbox', {originX: 50, originY: 400, unitX: 25, unitY: 25, axis: false, grid: false});
        xax = board.createElement('axis', [[0,0],[1,0]]);
        yax = board.createElement('axis', [[0,0],[0,1]]);

        p1 = board.createElement('point', [4, 4], {style:2,name:"A",fixed:true});
        p2 = board.createElement('point', [12, 4], {style:2,name:"B",fixed:true});

//	c = board.createElement('point', [8,10]);
        l1 = board.createElement('line', [[4,13], [12,13]]);
//        l1 = board.createElement('circle', [c,2]);
        p3 = board.createElement('glider', [8,13, l1], {style:5,name:"C"});

	p4 = board.createElement('centroid', [p1, p2, p3], {name:"S", trace:true});

        s = board.createElement('line', [p1, p2], {strokeColor:'green', straightLast: false});
        var ticks = board.createElement('ticks', [s, [-1.0, 1.0, 3.0, 9.0]]);
*/

        function getDependencies(e) {
            var anc = {};
            var b = e.board;

            // Anlegen temporaerer Variablen
            for(var i in b.objects) {
                b.objects[i].symbolic.visited = false;
                b.objects[i].symbolic.parents = {};
            }

            // Aufbauen eines Abhaengigkeitsbaums
            for(var i in b.objects) {
                for(var j in b.objects[i].childElements) {
                    b.objects[i].childElements[j].symbolic.parents[b.objects[i].id] = b.objects[i];
                }
            }

            // Durchlaufen des Baums um herauszufinden von welchen Punkten der Tracepunkt abhaengt.
            function walkThrough(x) {
                if(x.symbolic.visited)
                    return;

                x.symbolic.visited = true;
                anc[x.id] = x;
                for(var i in x.symbolic.parents) {
                    walkThrough(x.symbolic.parents[i]);
                }
            }
            walkThrough(e);
            delete anc[e.id];

            for(var i in b.objects) {
                delete b.objects[i].symbolic.visited;
                delete b.objects[i].symbolic.parents;
            }

            return anc;
        }

        function showAncestors(p) {
            document.getElementById("debug").innerHTML = "All elements: <br/>";
            for(var i in p.board.objects) {
                document.getElementById("debug").innerHTML += "* " + p.board.objects[i].id + "/" + p.board.objects[i].name + " <br/>";
            }
            document.getElementById("debug").innerHTML += "Parent elements of " + p.id + " / " + p.name + ": <br/>";
            var list = getDependencies(p);
            for(var t in list) {
                document.getElementById("debug").innerHTML += t + " -> " + p.ancestors[t].name + "<br/>";
            }
            document.getElementById("debug").innerHTML += "<br/>";
        }

        function genSymbCoords(p) {
//            var list = getDependencies(p);
            var list = p.ancestors;
            var u = 1;
            var num;
            for(var t in list) {
                num = 0;
                if (JXG.IsPoint(list[t])) {
                    for(var k in list[t].ancestors) {
                        num++;
                    }
                    if(num == 0) {
                        list[t].symbolic.x = p.ancestors[t].coords.usrCoords[1];
                        list[t].symbolic.y = p.ancestors[t].coords.usrCoords[2];
                    } else {
                        p.ancestors[t].symbolic.x = 'u[' + u + ']';
                        u++;
                        p.ancestors[t].symbolic.y = 'u[' + u + ']';
                        u++;
                    }

                    document.getElementById("debug").innerHTML += t + " [" + p.ancestors[t].name + "]: (" + p.ancestors[t].symbolic.x + ", " + p.ancestors[t].symbolic.y + ")<br/>";
                }
            }
            document.getElementById("debug").innerHTML += "<br/>";
        }

        function genPoly(p) {
            var num = JXG.Math.Symbolic.generateSymbolicCoordinatesPartial(board, p, 'u', 'brace');
            var list = p.ancestors;
            var num;
            var poly = [];
            for(var t in list) {
                num = 0;
                poly = [];
                if (JXG.IsPoint(list[t])) {
                    for(var k in list[t].ancestors) {
                        num++;
                    }
                    if(num > 0) {
                        poly = list[t].generatePolynom();
                        for(var i=0; i<poly.length; i++)
                            document.getElementById("debug").innerHTML += ">  " + poly[i] + "<br />";
                    }
                }
            }
            document.getElementById("debug").innerHTML += "<br/>";
        }

  /* ]]> */
  </script>
<a href="#" onclick="showAncestors(m1)">Show Ancestors</a><br />
<a href="#" onclick="genSymbCoords(m1)">Generate symbolic coordinates</a><br />
<a href="#" onclick="genPoly(m1);">Generate Polynomials</a><br />
<div id="debug" style="display:block;"></div>
<!--
<div id="jxgbox2" class="jxgbox" style="width:600px; height:450px; float:left"></div>
   <script type="text/javascript">
    /* <![CDATA[ */

        board2 = JXG.JSXGraph.initBoard('jxgbox2', {originX: 50, originY: 400, unitX: 25, unitY: 25, axis: false, grid: false});
        xax2 = board2.createElement('axis', [[0,0],[1,0]]);
        yax2 = board2.createElement('axis', [[0,0],[0,1]]);

        p12 = board2.createElement('point', [4, 4], {style:2,name:"A"});
        p22 = board2.createElement('point', [12, 4], {style:2,name:"B"});

        l12 = board2.createElement('line', [[4,13], [12,13]]);
        perp = board2.createElement('perpendicular', [p12, l12]);

        //p42 = board2.createElement('centroid', [p12, p22, p32], {name:"S", trace:true});

  /* ]]> */
  </script>
//-->
</body>
</html>
