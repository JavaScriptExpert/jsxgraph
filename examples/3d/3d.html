<html>
<head>
   <title>JSXGraph Konstruktionstemplate</title>
   <!--
   <link rel="stylesheet" type="text/css" href="http://jsxgraph.uni-bayreuth.de/distrib/jsxgraph.css" />
   <script type="text/javascript" src="http://jsxgraph.uni-bayreuth.de/distrib/jsxgraphcore.js"></script>
   -->
   <link rel="stylesheet" type="text/css" href="../distrib/jsxgraph.css" />
   <script type="text/javascript" src="../../distrib/prototype.js"></script>
   <script type="text/javascript" src="../../src/loadjsxgraph.js"></script>
</head>
<body>

  <div id="jxgbox" class="jxgbox" style="width:500px; height:500px;"></div>
  <script type="text/javascript">
  /* <![CDATA[ */

  board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-50, 50, 50, -50], axis: true, grid: false,
                                 keepaspectratio: true, showcopyright: false}); 


	  
JXG.Point3D = function (coordinates, camera_coordinates, normal_coordinates) {
	this.coordinates = coordinates;    
    if (this.coordinates==null) {
        this.coordinates=[0,0,0];
    }	  
    this.camera_coordinates = camera_coordinates;
    if (this.camera_coordinates==null) {
        this.camera_coordinates=[0,0,0];
    }
    this.normal_coordinates = normal_coordinates;
    if (this.normal_coordinates==null) {
        this.normal_coordinates=[0,0,0];
    }
    this.point = board.createElement("point",this.proj(),{visible: false});
}

//JXG.Point3D.prototype = new JXG.GeometryElement();

JXG.Point3D.prototype.proj = function () {
	var p = this;
	var alpha, beta, gamma, dx, dy, dz;
	var coordinates_now = [0,0,0];
	var camera_coordinates_now = [0,0,0];
	var normal_coordinates_now = [0,0,0];
	
	var adaptParameter = function(a, b){
    		for (var i=0; i<a.length; i++){
		    	if (isNaN(Number(a[i]))){
					b[i] = a[i]();
				}
				else
					b[i] = a[i];
    		}
    };
    var update = function(){
    	adaptParameter(p.coordinates, coordinates_now);
    	adaptParameter(p.camera_coordinates, camera_coordinates_now);
    	adaptParameter(p.normal_coordinates, normal_coordinates_now);
    	alpha = Math.atan(normal_coordinates_now[2]/normal_coordinates_now[1]);
		beta = Math.atan(normal_coordinates_now[0]/normal_coordinates_now[2]);
		gamma = Math.atan(normal_coordinates_now[1]/normal_coordinates_now[0]);
		dx = (Math.cos(beta)*(Math.cos(gamma)*(coordinates_now[0]-camera_coordinates_now[0])-Math.sin(gamma)*(coordinates_now[1]-camera_coordinates_now[1]))+Math.sin(beta)*(coordinates_now[2]-camera_coordinates_now[2]));
		dy = (Math.sin(alpha)*(Math.sin(beta)*(Math.cos(gamma)*(coordinates_now[0]-camera_coordinates_now[0])-Math.sin(gamma)*(coordinates_now[1]-camera_coordinates_now[1]))-Math.cos(beta)*(coordinates_now[2]-camera_coordinates_now[2]))+Math.cos(alpha)*(Math.sin(gamma)*(coordinates_now[0]-camera_coordinates_now[0])+Math.cos(gamma)*(coordinates_now[1]-camera_coordinates_now[1])));
		dz = (Math.sin(alpha)*(Math.sin(gamma)*(coordinates_now[0]-camera_coordinates_now[0])+Math.cos(gamma)*(coordinates_now[1]-camera_coordinates_now[1]))+Math.cos(alpha)*(Math.sin(beta)*(Math.sin(gamma)*(coordinates_now[1]-camera_coordinates_now[1])-Math.cos(gamma)*(coordinates_now[0]-camera_coordinates_now[0]))+Math.cos(beta)*(coordinates_now[2]-camera_coordinates_now[2])));
    }
    
	var fx = function(){
		update();
		return ((Math.sqrt(normal_coordinates_now[0]*normal_coordinates_now[0]+normal_coordinates_now[1]*normal_coordinates_now[1]+normal_coordinates_now[2]*normal_coordinates_now[2]))/dz*dx);
	};
	var fy = function(){
		//update(); //this update needs to be calles separately, if fy is called without fx being called (ME) 
		return((Math.sqrt(normal_coordinates_now[0]*normal_coordinates_now[0]+normal_coordinates_now[1]*normal_coordinates_now[1]+normal_coordinates_now[2]*normal_coordinates_now[2]))/dz*dy)
	};
    return [fx,fy];
}
    
	  
	  
function projektion(punkt, kpunkt, n){

	var x = punkt[0];
	var y = punkt[1];
	var z = punkt[2];
	
	var kx = kpunkt[0];
	var ky = kpunkt[1];
	var kz = kpunkt[2];
	
	var nx = n[0];
	var ny = n[1];
	var nz = n[2];
	
	
	var alpha = Math.atan(nz/ny);
	var beta =  Math.atan(nx/nz);
	var gamma =  Math.atan(ny/nx);
	var dx =  (Math.cos(beta)*(Math.cos(gamma)*(x-kx)-Math.sin(gamma)*(y-ky))+Math.sin(beta)*(z-kz));
	var dy =  (Math.sin(alpha)*(Math.sin(beta)*(Math.cos(gamma)*(x-kx)-Math.sin(gamma)*(y-ky))-Math.cos(beta)*(z-kz))+Math.cos(alpha)*(Math.sin(gamma)*(x-kx)+Math.cos(gamma)*(y-ky)));
	var dz = (Math.sin(alpha)*(Math.sin(gamma)*(x-kx)+Math.cos(gamma)*(y-ky))+Math.cos(alpha)*(Math.sin(beta)*(Math.sin(gamma)*(y-ky)-Math.cos(gamma)*(x-kx))+Math.cos(beta)*(z-kz)));		  
	return board.createElement('point',[
          function() { return ((Math.sqrt(nx*nx+ny*ny+nz*nz))/dz*dx);},
          function() { return ((Math.sqrt(nx*nx+ny*ny+nz*nz))/dz*dy);}
	]);

	
}


board.createElement("circle",[[-30,30],10]);
cam = board.createElement("point",[-30,30]);


newYcam = function (){
	return Math.sqrt(100-((cam.X()+30)*(cam.X()+30)+(cam.Y()-30)*(cam.Y()-30)));
}
newXcam = function (){
	return cam.X()+30;
} 
newZcam = function (){
	return cam.Y()-30;
}  
a = new JXG.Point3D([1,1,-1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);
b = new JXG.Point3D([1,-1,-1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);
c = new JXG.Point3D([-1,-1,-1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);
d = new JXG.Point3D([-1,1,-1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);

e = new JXG.Point3D([1,1,1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);
f = new JXG.Point3D([1,-1,1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);
g = new JXG.Point3D([-1,-1,1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);
h = new JXG.Point3D([-1,1,1],[function(){return newXcam();},function(){return newYcam();},function(){return newZcam();}],[4,1,3]);

board.createElement('polygon',[a.point,b.point,c.point,d.point]);
board.createElement('polygon',[e.point,f.point,g.point,h.point]);
board.createElement('line',[a.point,e.point],{straightFirst:false, straightLast:false});
board.createElement('line',[b.point,f.point],{straightFirst:false, straightLast:false});
board.createElement('line',[c.point,g.point],{straightFirst:false, straightLast:false});
board.createElement('line',[d.point,h.point],{straightFirst:false, straightLast:false});


 
/* ]]> */
  

</script>
</body>
</html>