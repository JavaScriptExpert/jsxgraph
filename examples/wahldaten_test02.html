<html>
<head>
   <title>JSXGraph example</title>
   <link rel="stylesheet" type="text/css" href="../distrib/jsxgraph.css" />
   <script type="text/javascript" src="../distrib/prototype.js"></script>
   <script type="text/javascript" src="../src/loadjsxgraph.js"></script>
   <script type="text/javascript" src="wahldaten.js"></script>
   <script type="text/javascript" src="germany.js"></script>   
</head>
<body>
<h2>Curve Test</h2>
<div style="width:800px">
  <div id="jxgbox" class="jxgbox" style="width:500px; height:700px; float:left"></div>
  <div id="wahlkreis">&nbsp;</div>
</div>
<form>
    <input type="radio" value="0" onclick="selectParty(0);" name="parties" checked='checked'>CDU/CSU<br/>
    <input type="radio" value="1" onclick="selectParty(1);" name="parties">SPD<br/>
    <input type="radio" value="2" onclick="selectParty(2);" name="parties">FDP<br/>
    <input type="radio" value="3" onclick="selectParty(3);" name="parties">Die Gr&uuml;nen<br/>
    <input type="radio" value="4" onclick="selectParty(4);" name="parties">Die Linke<br/>
</form>
<br>
<div id="debug" ></div>
   <script type="text/javascript">
    /* <![CDATA[ */
    var minX =-289319.4,
        maxY = 6827620,
        maxX = 351315.7,
        minY = 5960587,
        brd,
        wahlkreisNode = document.getElementById('wahlkreis').firstChild,    
        points = [],
        len = data.length, // from germany.js
        lastWk = null,
        lastWkNr = 0,
        i, col = 0;
    
    var CDUcols = ['#d3e9fe','#8db0fe','#405dff','#002ba5','#001654'];
    var SPDcols = ['#ffceb8','#fe946a','#f83a1f','#bb0000','#7e0900'];
    var FDPcols = ['#f9feae','#fff95e','#fee80c','#fecc12','#ffc400'];
    var GRUENcols = ['#e4de4d','#b5c213','#508229','#508229','#062f00'];
    var LINKScols = ['#fed0f5','#f3a3ff','#cb6cff','#952aea','#640390'];
    var CDUCSU = new Array(299);
    var SPD = new Array(299);
    var FDP = new Array(299);
    var GRUEN = new Array(299);
    var LINKS = new Array(299);
    var Zweit = new Array(299);
    var wkNamen = new Array(299);
    var wkCurves = new Array(300);
    for(i=0;i<300;i++) {
        wkCurves[i] = [];
    }
    
    for(var i=5; i<337; i++) {
        if(wahldata[i*135+1] != "") { // keine Leerzeile
            if(wahldata[i*135+3] != "99" && wahldata[i*135+3] != "") { // kein Bundesland, auch nicht Bundesgebiet
                if(wahldata[i*135+3] == "9") {
                    CDUCSU[ wahldata[i*135+1] ] = wahldata[i*135+42]/wahldata[i*135+18]*100; // CSU
                }
                else {
                    CDUCSU[ wahldata[i*135+1] ] = wahldata[i*135+26]/wahldata[i*135+18]*100; // CDU
                }
                
                SPD[ 1*wahldata[i*135+1] ] = wahldata[i*135+22]/wahldata[i*135+18]*100;
                FDP[ 1*wahldata[i*135+1] ] = wahldata[i*135+30]/wahldata[i*135+18]*100;
                GRUEN[ 1*wahldata[i*135+1] ] = wahldata[i*135+38]/wahldata[i*135+18]*100;
                LINKS[ 1*wahldata[i*135+1] ] = wahldata[i*135+34]/wahldata[i*135+18]*100;
                Zweit[ 1*wahldata[i*135+1] ] =  wahldata[i*135+18];
                wkNamen[ 1*wahldata[i*135+1] ] =  wahldata[i*135+2];
            }
        }
    }    

    function selectParty(i) {
        if(i==0) { // CDU/CSU
            for(var j=1;j<299;j++) {
                for(var k=0; k< wkCurves[j].length; k++) {
                    wkCurves[j][k].setProperty('fillColor:'+getCSUcolor(j));
                }
            }
        }    
        else if(i==1) { // SPD
            for(var j=1;j<299;j++) {
                for(var k=0; k< wkCurves[j].length; k++) {
                    wkCurves[j][k].setProperty('fillColor:'+getSPDcolor(j));
                }
            }
        }
        else if(i==2) { // FDP
            for(var j=1;j<299;j++) {
                for(var k=0; k< wkCurves[j].length; k++) {
                    wkCurves[j][k].setProperty('fillColor:'+getFDPcolor(j));
                }
            }
        }   
        else if(i==3) { // GRUEN
            for(var j=1;j<299;j++) {
                for(var k=0; k< wkCurves[j].length; k++) {
                    wkCurves[j][k].setProperty('fillColor:'+getGRUENcolor(j));
                }
            }
        }  
        else if(i==4) { // LINKS
            for(var j=1;j<299;j++) {
                for(var k=0; k< wkCurves[j].length; k++) {
                    wkCurves[j][k].setProperty('fillColor:'+getLINKScolor(j));
                }
            }
        }          
    }
    
    function getSPDcolor(col) {
        if(SPD[col] <= 18) { return SPDcols[0]; }
        else if(SPD[col] > 18 && SPD[col] <= 23) { return SPDcols[1]; }
        else if(SPD[col] > 23 && SPD[col] <= 28) { return SPDcols[2]; }
        else if(SPD[col] > 28 && SPD[col] <= 33) { return SPDcols[3]; }
        else { return SPDcols[4]; }
    }
    
    function getCSUcolor(col) {
        if(CDUCSU[col] <= 30) { return CDUcols[0]; }
        else if(CDUCSU[col] > 30 && CDUCSU[col] <= 35) { return CDUcols[1]; }
        else if(CDUCSU[col] > 35 && CDUCSU[col] <= 40) { return CDUcols[2]; }
        else if(CDUCSU[col] > 40 && CDUCSU[col] <= 45) { return CDUcols[3]; }
        else { return CDUcols[4]; }
    }   
    
    function getFDPcolor(col) {
        if(FDP[col] <= 10) { return FDPcols[0]; }
        else if(FDP[col] > 10 && FDP[col] <= 13) { return FDPcols[1]; }
        else if(FDP[col] > 13 && FDP[col] <= 16) { return FDPcols[2]; }
        else if(FDP[col] > 16 && FDP[col] <= 19) { return FDPcols[3]; }
        else { return FDPcols[4]; }
    } 
    
    function getGRUENcolor(col) {
        if(GRUEN[col] <= 6) { return GRUENcols[0]; }
        else if(GRUEN[col] > 6 && GRUEN[col] <= 10) { return GRUENcols[1]; }
        else if(GRUEN[col] > 10 && GRUEN[col] <= 14) { return GRUENcols[2]; }
        else if(GRUEN[col] > 14 && GRUEN[col] <= 20) { return GRUENcols[3]; }
        else { return GRUENcols[4]; }
    }   

    function getLINKScolor(col) {
        if(LINKS[col] <= 12) { return LINKScols[0]; }
        else if(LINKS[col] > 12 && LINKS[col] <= 19) { return LINKScols[1]; }
        else if(LINKS[col] > 19 && LINKS[col] <= 26) { return LINKScols[2]; }
        else if(LINKS[col] > 26 && LINKS[col] <= 33) { return LINKScols[3]; }
        else { return LINKScols[4]; }
    }   
    
    
    brd = JXG.JSXGraph.initBoard('jxgbox', {boundingbox:[minX-1000,maxY+1000,maxX+1000,minY-1000],
                                        keepaspectratio:true});

    for(i=0;i<len;i++) {
        if(i%6==1) {
            lastWk = data[i];
        }
        else if(i%6==0) {
            lastWkNr = data[i];
        }        
        else if(i%6 == 5) {
            points.push([data[i],lastWk,lastWkNr]);
        }
    }

    function createCurve(area)  {
        var xy = area[0].split(','),
            x = [], y = [],
            c = [], len, i, a, graph;
            
        len = xy.length;
        for(i=0;i<len;i++) {
            a = xy[i].split(' ');
            c.push(new JXG.Coords(JXG.COORDS_BY_USER, [1*a[0], 1*a[1]], brd));
        }
        c = brd.renderer.RamenDouglasPeuker(c,1.3);
        len = c.length;
        for (i=0;i<len;i++) {
            x.push(c[i].usrCoords[1]);
            y.push(c[i].usrCoords[2]);
        }
        graph = brd.createElement('curve', [x,y], 
                        {fillColor:getCSUcolor(area[2]),
                         highlightFillColor:'yellow',
                         strokeWidth:1,strokeColor:'black',highlightStrokeColor:'black'});
        wkCurves[ [area[2]] ].push(graph);
                         
        JXG.addEvent(graph.rendNode, 'mouseover', function(){graph.highlight(); /*wahlkreisNode.nodeValue=CDUCSU[area[2] ]+" "+area[2];*/}, graph);
        JXG.addEvent(graph.rendNode, 'mouseout', function(){graph.noHighlight();}, graph);
        graph.hasPoint = function(){return false; };
    }

    function final() {
        brd.unsuspendUpdate();
    }

    //Copyright 2009 Nicholas C. Zakas. All rights reserved.
    //MIT Licensed
    function timedChunk(items, process, context, callback){
        var todo = items.concat();   //create a clone of the original
        setTimeout(function(){
            var start = +new Date();
            do {
                process.call(context, todo.shift());
            } while (todo.length > 0 && (+new Date() - start < 300));
            if (todo.length > 0){
                setTimeout(arguments.callee, 1);
            } else {
                callback(items);
            }
        }, 1);
    }

    brd.suspendUpdate();
    timedChunk(points, createCurve, null, final);














/*
    var minX =-289319.4;
    var maxY = 6827620;
    var maxX = 351315.7;
    var minY = 5960587;
    var wahlkreisNode = document.getElementById('wahlkreis').firstChild;      
    var brd = JXG.JSXGraph.initBoard('jxgbox', {boundingbox:[minX-1000,maxY+1000,maxX+1000,minY-1000],
                                        keepaspectratio:true});

    var xArr = germany[0];
    var yArr = germany[1];
    var list = [];
    for (i=0;i<xArr.length;i++) { list[i] = i; };
    var col = 0;
    


    function createCurve(number)  {
    $('debug').innerHTML += number+" ";
        var x = [];
        var y = [];
        var c = [];
        len = xArr[number].length;
        for(var i=0;i<len;i++) {
            c.push(new JXG.Coords(JXG.COORDS_BY_USER, [xArr[number][i], yArr[number][i]], brd));
        }
        c = brd.renderer.RamenDouglasPeuker(c,1.25);
        len = c.length;
        for (i=0;i<len;i++) {
            x.push(c[i].usrCoords[1]);
            y.push(c[i].usrCoords[2]);
        }
        var graph = brd.createElement('curve', [x,y], 
                        {fillColor: getCSUcolor(number),                    
                         highlightFillColor:'yellow',
                         strokeWidth:1,
                         strokeColor:'black',
                         highlightStrokeColor:'black',id:'wk'+number});
        JXG.addEvent(graph.rendNode, 'mouseover', function(){graph.highlight(); wahlkreisNode.nodeValue=graph.id;}, graph);
        JXG.addEvent(graph.rendNode, 'mouseout', function(){graph.noHighlight();}, graph);
        graph.hasPoint = function(){return false; };
    }

    function final() {
        brd.unsuspendUpdate();
        //document.getElementById('debug').innerHTML += '. ';
    }

    //Copyright 2009 Nicholas C. Zakas. All rights reserved.
    //MIT Licensed
    function timedChunk(items, process, context, callback){
        var todo = items.concat();   //create a clone of the original

        setTimeout(function(){

            var start = +new Date();

            do {
                 process.call(context, todo.shift());
            } while (todo.length > 0 && (+new Date() - start < 300));

            if (todo.length > 0){
                setTimeout(arguments.callee, 1);
            } else {
                callback(items);
            }
        }, 1);
    }

    brd.suspendUpdate();
    timedChunk(list, createCurve, null, final);    
    */

          /* ]]> */
  </script>
</body>
</html>
